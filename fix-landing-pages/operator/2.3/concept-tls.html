<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Couchbase TLS | Couchbase Docs (Local)</title>
<link rel="canonical" href="https://maria-robobug.github.io/operator/2.3/concept-tls.html">
<link rel="stylesheet" href="../../_/css/site.css">
<script src="../../_/js/vendor/jquery.js"></script>
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="operator">
<meta name="dcterms.identifier" content="2.3">
<meta name="page-url" content="/operator/2.3/concept-tls.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://maria-robobug.github.io/home/index.html">
                    <img src="../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://maria-robobug.github.io/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../cloud-native-database/index.html">
                      Cloud-Native
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/mariashodunke/Couchbase/docs/couchbase-operator/docs/user/modules/ROOT/pages/concept-tls.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="overview.html">Autonomous Operator</a></li>
<li class="crumb">Learn</li>
<li class="crumb">Couchbase Cluster Concepts</li>
<li class="crumb">TLS</li>
<li class="crumb"><a href="concept-tls.html">Couchbase TLS</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Couchbase TLS</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
Transport layer security (TLS) is responsible for securing data over networks.
This section documents what security protections are available.
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="basic-tls-configuration"><a class="anchor" href="#basic-tls-configuration"></a>Basic TLS Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Server supports TLS out of the box.
Couchbase Server generates a self-signed CA certificate for the whole cluster.
Each pod that is added to the cluster gets a certificate valid for its hostname.</p>
</div>
<div class="paragraph">
<p>The TLS certificates generated by Couchbase Server are, however, not suited for use with Kubernetes.
The DNS subject alternative names are insufficient to support anything other than very specific service naming, or any form of highly-available addressing.</p>
</div>
<div class="paragraph">
<p>For this reason, Couchbase Server provided TLS is not supported for use with the Operator or any Kubernetes environment.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="managed-tls-configuration"><a class="anchor" href="#managed-tls-configuration"></a>Managed TLS Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When using basic configuration the end user has no control over how the certificates are generated.</p>
</div>
<div class="paragraph">
<p>When using the public connectivity feature for example&#8201;&#8212;&#8201;the Couchbase Cluster is accessed from outside of the Kubernetes cluster&#8201;&#8212;&#8201;the internal DNS names that would be automatically generated by Couchbase Server are no longer valid.
The certificate needs to be valid for an alternative public DNS name.
Likewise the Prometheus exporter when operating over TLS needs to access the local pod on <code>localhost</code>.
It may also be desirable to integrate Couchbase Server into an existing corporate TLS hierarchy.</p>
</div>
<div class="paragraph">
<p>Managed TLS gives the ability for you to use any TLS certificates you like with Couchbase Server.
A certificate may be a single certificate or an entire certificate chain.</p>
</div>
<div class="paragraph">
<p>TLS can be configured by the Operator in a number of different ways as described in the following sections.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using managed TLS, the Operator and any sidecar containers will also communicate with Couchbase Server over TLS.
Use of managed TLS is highly recommended in order to encrypt passwords and other sensitive information that may be exchanged between Couchbase Server and the Operator.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For configuration details please see the <a href="howto-tls.html" class="xref page">TLS configuration how-to</a>.</p>
</div>
<div class="sect2">
<h3 id="kubernetes-native-tls"><a class="anchor" href="#kubernetes-native-tls"></a>Kubernetes Native TLS</h3>
<div class="paragraph">
<p><kbd>operator 2.3</kbd></p>
</div>
<div class="paragraph">
<p>From Operator version 2.3 onward, Kubernetes native TLS is the standard way of configuring TLS.
Consider the following topology:</p>
</div>
<div class="paragraph">
<div class="title">Kubernetes Native TLS Topology</div>
<p><span class="image"><img src="_images/tls-kubernetes.png" alt="tls kubernetes"></span></p>
</div>
<div class="paragraph">
<p>All Kubernetes secrets are of the standard <code>kubernetes.io/tls</code> type.
This provides the most generic method of TLS configuration, and the largest scope for 3rd party TLS management integration.</p>
</div>
<div class="paragraph">
<p>CA certificates are provided as a pool, whose referenced secrets only need contain the <code>tls.crt</code> field&#8201;&#8212;&#8201;it is unnecessary to expose private keys to maintain security.
A CA pool allows Couchbase Server to utilize one CA, while client certificates can authenticate against an arbitrary number of certificate authorities.
This provides isolated security domains and allows rolling CA rotation with minimal operational impact.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using Couchbase 7.0 and earlier, only one CA is supported, therefore all server and client certificates must be signed by the same root CA.
Specifying multiple CA certificates with Couchbase Server 7.0 and earlier will result in undefined behavior.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Couchbase Server has strict naming and format requirements for server certificates and keys (see <a href="#legacy-tls">Legacy TLS</a>).
When using Kubernetes native TLS, the Operator abstracts some of these away to make configuration more flexible and compatible with your security requirements.
For example, this configuration mode supports PKCS#8 formatted RSA keys.
Elliptic curve is not supported by Couchbase Server, and the Operator is unable to convert between EC and RSA key types.</p>
</div>
</div>
<div class="sect2">
<h3 id="cert-manager-tls"><a class="anchor" href="#cert-manager-tls"></a>Cert-Manager TLS</h3>
<div class="paragraph">
<p><kbd>operator 2.2</kbd></p>
</div>
<div class="paragraph">
<p>Cert-Manager TLS is an extension of <a href="#kubernetes-native-tls">Kubernetes Native TLS</a>.
The only difference is highlighted in red in the following topology:</p>
</div>
<div class="paragraph">
<div class="title">Cert-Manager TLS Topology</div>
<p><span class="image"><img src="_images/tls-cert-manager.png" alt="tls cert manager"></span></p>
</div>
<div class="paragraph">
<p>Cert-manager generates TLS keys and certificates using the <code>kubernetes.io/tls</code>, and additionally supplies a <code>ca.crt</code> field in the secret, so you don&#8217;t need to worry about providing it manually via the CA pool.</p>
</div>
<div class="paragraph">
<p>The <code>ca.crt</code> field is not respected&#8201;&#8212;&#8201;if provided&#8201;&#8212;&#8201;in the client secret.
The root CA pool can be used to support a different client signing CA.
See <a href="#kubernetes-native-tls">Kubernetes Native TLS</a> for additional details on multiple root CA support.</p>
</div>
<div class="paragraph">
<p>For more information, read the <a href="tutorial-cert-manager.html" class="xref page">Cert-Manager Tutorial</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="legacy-tls"><a class="anchor" href="#legacy-tls"></a>Legacy TLS</h3>
<div class="paragraph">
<p><kbd>deprecated</kbd></p>
</div>
<div class="paragraph">
<p>Legacy TLS was initially designed as a direct integration of TLS with Couchbase Server.
Consider the diagram below:</p>
</div>
<div class="paragraph">
<div class="title">Legacy TLS Topology</div>
<p><span class="image"><img src="_images/tls-legacy.png" alt="tls legacy"></span></p>
</div>
<div class="paragraph">
<p>The server secret contains the server certificate and key that need to be mounted in the Couchbase Server pod.
As no abstraction is performed by the Operator, the secret format and key names are non-standard, and need to be those hard-coded into Couchbase Server.
Additionally only PKCS#1 formatted keys are supported.</p>
</div>
<div class="paragraph">
<p>This bespoke domain specific format is inflexible and incompatible with any 3rd party certificate management.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use of this configuration mode is deprecated and will be removed in a future release.
It is highly recommended that you use, or migrate to, one of the other modes.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="node-to-node-encryption"><a class="anchor" href="#node-to-node-encryption"></a>Node-to-Node Encryption</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Operator supports Couchbase Server&#8217;s node-to-node encryption feature.
Secure network layer transport between pods is not secure by default, and needs to be manually enabled.
To enable node-to-node encryption, TLS must be Operator managed.</p>
</div>
<div class="paragraph">
<p>The following modes are available:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Strict TLS <kbd>operator 2.3</kbd></dt>
<dd>
<p>All traffic between pods, be that internal control communication or user data, is encrypted.
Additionally non-TLS ports are not exposed and cannot be used.
Strict mode TLS is only available on Couchbase Server 7.1+.</p>
</dd>
<dt class="hdlist1">Full TLS</dt>
<dd>
<p>All traffic between pods, be that internal control communication or user data, is encrypted.</p>
</dd>
<dt class="hdlist1">Control plane TLS</dt>
<dd>
<p>Only internal control communication is encrypted.
While this may be marginally faster, it will expose any user data on the network.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For further information, see read about the <code>spec.networking.tls.nodeToNodeEncryption</code> field.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tls-client-authentication"><a class="anchor" href="#tls-client-authentication"></a>TLS Client Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Server supports mutual TLS (mTLS).
With this mode of operation not only do clients verify they are talking to a trusted entity, but the Couchbase Server instance can also establish trust in the client.
Client authentication may be mandatory or optional.</p>
</div>
<div class="paragraph">
<p>When using mTLS then the certificate must also contain identity information in the form of a username that maps to a Couchbase Server user.
With optional authentication if the client does not supply a certificate to Couchbase Server on request then it will fall back to basic (username &amp; password) authentication.</p>
</div>
<div class="paragraph">
<p>mTLS is fully supported by the Operator.
When enabled the user must supply the Operator with a client certificate valid for the cluster administrator.</p>
</div>
<div class="paragraph">
<p>For configuration details please see the <a href="howto-tls-client-certificates.html" class="xref page">TLS client certificate how-to</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tls-certificate-rotation"><a class="anchor" href="#tls-certificate-rotation"></a>TLS Certificate Rotation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Certificates go out of date and cause clients to stop working.
Private keys corresponding to certificates can be compromised thus allowing communications to be decrypted.
With this in mind, the Operator allows certificates to be rotated and replaced with new versions.</p>
</div>
<div class="paragraph">
<p>The Operator supports all possible rotation types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Replacing a server certificate/key</p>
</li>
<li>
<p>Replacing a client certificate/key</p>
</li>
<li>
<p>Replacing the entire PKI</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For details on certificate rotation read the <a href="howto-tls-rotation.html" class="xref page">TLS certificate rotation how-to</a>.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2022 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Autonomous Operator","components":["operator"],"latestVersions":{"operator":"2.3"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../_/js/site.js"></script>
<script defer src="../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
</body>
</html>
