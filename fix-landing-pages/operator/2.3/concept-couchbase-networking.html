<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Couchbase Networking | Couchbase Docs (Local)</title>
<link rel="canonical" href="https://maria-robobug.github.io/operator/2.3/concept-couchbase-networking.html">
<link rel="stylesheet" href="../../_/css/site.css">
<script src="../../_/js/vendor/jquery.js"></script>
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="operator">
<meta name="dcterms.identifier" content="2.3">
<meta name="page-url" content="/operator/2.3/concept-couchbase-networking.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://maria-robobug.github.io/home/index.html">
                    <img src="../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://maria-robobug.github.io/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../cloud-native-database/index.html">
                      Cloud-Native
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/mariashodunke/Couchbase/docs/couchbase-operator/docs/user/modules/ROOT/pages/concept-couchbase-networking.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="overview.html">Autonomous Operator</a></li>
<li class="crumb">Learn</li>
<li class="crumb">Couchbase Cluster Concepts</li>
<li class="crumb">Networking</li>
<li class="crumb"><a href="concept-couchbase-networking.html">Couchbase Networking</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Couchbase Networking</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
Connecting to a Couchbase cluster in Kubernetes is challenging.
This section outlines supported strategies and key concepts.
</blockquote>
</div>
<div class="paragraph">
<p>Couchbase Server is a high performance database, with data is distributed across all pods in a cluster.
Clients are aware of which pod a data item should reside on and perform client-side load balancing.
By performing the load balancing in the client, this avoids unnecessary network hops and improves performance.
For this reason Couchbase Server cannot be accessed using normal Kubernetes <code>Service</code> or <code>Ingress</code> resources.</p>
</div>
<div class="paragraph">
<p>The following options depict the possible networking topologies for connecting clients to a Couchbase cluster.
Clients includes all Couchbase Client SDKs, Couchbase Mobile and Couchbase XDCR connections unless otherwise stated.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="intra-kubernetes-networking"><a class="anchor" href="#intra-kubernetes-networking"></a>Intra-Kubernetes Networking</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Intra-Kubernetes networking is the simplest and allow clients running in the same Kubernetes cluster as the Couchbase server instance.
This method of communication can be used by any client.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/networking-basic-intra.png" alt="networking basic intra">
</div>
<div class="title">Figure 1. Basic Intra-Kubernetes Networking</div>
</div>
<div class="paragraph">
<p>The client can use endpoint DNS entries to connect to individual Couchbase nodes.
Stable service discovery is provided by SRV records.
TLS can be used to secure communications.</p>
</div>
<div class="ulist">
<div class="title">Learn More</div>
<ul>
<li>
<p><a href="howto-ui.html#port-forwarding" class="xref page">How-to connect to the UI</a></p>
</li>
<li>
<p><a href="howto-client-sdks.html#dns-based-addressing" class="xref page">How-to connect a client SDK</a></p>
</li>
<li>
<p><a href="howto-xdcr.html#dns-based-addressing" class="xref page">How-to configure XDCR</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="inter-kubernetes-networking-with-forwarded-dns"><a class="anchor" href="#inter-kubernetes-networking-with-forwarded-dns"></a>Inter-Kubernetes Networking with Forwarded DNS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Inter-Kubernetes networking allows clients to connect to Couchbase server instances in a remote Kubernetes cluster.
It uses the DNS service offered by the remote Kubernetes cluster to provide addressing.</p>
</div>
<div class="paragraph">
<p>A local DNS server is used by Couchbase Server and clients to forward DNS requests for a remote namespace to a remote Kubernetes cluster.
Requests that do not fall into this DNS zone are forwarded to the local DNS service.
Any DNS server that supports forwarding of zones to remote DNS servers can be used, but we recommend <a href="https://coredns.io" target="_blank" rel="noopener">CoreDNS</a> as the de facto cloud native standard.</p>
</div>
<div class="paragraph">
<p>This method of communication can only be used if clients in one cluster can communicate with pods in another&#8201;&#8212;&#8201;it uses <a href="concept-kubernetes-networking.html#routed-networking" class="xref page">routed networking</a>.
For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Google GKE allows multiple Kubernetes clusters in the same virtual private cloud, and has routed networking by default.</p>
</li>
<li>
<p>Amazon AWS can use the <a href="https://github.com/aws/amazon-vpc-cni-k8s" target="_blank" rel="noopener">VPC CNI plugin</a> to create routed networks that can be peered together.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/networking-basic-forwarded-dns.png" alt="networking basic forwarded dns">
</div>
<div class="title">Figure 2. Basic Inter-Kubernetes Networking</div>
</div>
<div class="paragraph">
<p>The client can use endpoint DNS entries to connect to individual Couchbase nodes.
Stable service discovery is provided by SRV records.
TLS can be used to secure communications.</p>
</div>
<div class="ulist">
<div class="title">Learn More</div>
<ul>
<li>
<p><a href="howto-ui.html#port-forwarding" class="xref page">How-to connect to the UI</a></p>
</li>
<li>
<p><a href="howto-client-sdks.html#dns-based-addressing" class="xref page">How-to connect a client SDK</a></p>
</li>
<li>
<p><a href="howto-xdcr.html#dns-based-addressing" class="xref page">How-to configure XDCR</a></p>
</li>
<li>
<p><a href="tutorial-remote-dns.html" class="xref page">Inter-Kubernetes networking with forwarded DNS tutorial</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="public-networking-with-external-dns"><a class="anchor" href="#public-networking-with-external-dns"></a>Public Networking with External DNS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Public networking allows clients to connect to Couchbase server instances from anywhere with an Internet connection.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/kubernetes-sigs/external-dns" target="_blank" rel="noopener">External DNS</a> is a service that can be run in a Kubernetes namespace.
It allows services to advertise load-balancer service public IP addresses with public DDNS services.
This networking type requires <a href="#exposed-features">Exposed Features</a>, which has its own <a href="#exposed-features-client-requirements">client requirements and limitations</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/networking-basic-external-dns.png" alt="networking basic external dns">
</div>
<div class="title">Figure 3. Basic Public Networking</div>
</div>
<div class="paragraph">
<p>The client can use DNS names for load-balancer service public IP addresses to connect to individual Couchbase nodes.
Stable service discovery is provided by a load-balanced HTTP connection to the cluster admin service.
TLS must be used to secure communications.</p>
</div>
<div class="ulist">
<div class="title">Learn More</div>
<ul>
<li>
<p><a href="howto-public-networking.html" class="xref page">How-to configure public networking</a></p>
</li>
<li>
<p><a href="howto-ui.html#dns-based-addressing" class="xref page">How-to connect to the UI</a></p>
</li>
<li>
<p><a href="howto-client-sdks.html#dns-based-addressing-with-external-dns" class="xref page">How-to connect a client SDK</a></p>
</li>
<li>
<p><a href="howto-xdcr.html#dns-based-addressing-with-external-dns" class="xref page">How-to configure XDCR</a></p>
</li>
<li>
<p><a href="tutorial-public-addressability.html" class="xref page">Public networking tutorial</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generic-networking"><a class="anchor" href="#generic-networking"></a>Generic Networking</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Generic networking use is discouraged for production deployments.
It should be avoided in preference for one of the prior methods of communication.
This networking type requires <a href="#exposed-features">Exposed Features</a>, which has its own <a href="#exposed-features-client-requirements">client requirements and limitations</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/networking-basic-nodeport.png" alt="networking basic nodeport">
</div>
<div class="title">Figure 4. Generic Networking</div>
</div>
<div class="paragraph">
<p>The client uses Kubernetes node ports to connect to individual Couchbase nodes.
Stable service discovery is not possible.
TLS cannot be used to secure communications.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using Istio or another service mesh, remember that strict mode mTLS cannot be used with Kubernetes node ports.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Learn More</div>
<ul>
<li>
<p><a href="howto-nodeport-networking.html" class="xref page">How-to configure node port networking</a></p>
</li>
<li>
<p><a href="howto-ui.html#port-forwarding" class="xref page">How-to connect to the UI</a></p>
</li>
<li>
<p><a href="howto-client-sdks.html#ip-based-addressing" class="xref page">How-to connect a client SDK</a></p>
</li>
<li>
<p><a href="howto-xdcr.html#ip-based-addressing" class="xref page">How-to configure XDCR</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exposed-features"><a class="anchor" href="#exposed-features"></a>Exposed Features</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Both <a href="#public-networking-with-external-dns">Public Networking with External DNS</a> and <a href="#generic-networking">Generic Networking</a> require client traffic to cross as DNAT boundary.
In both cases clients connect to different IP addresses than those of the underlying Couchbase pods.
As a result when clients initially contact Couchbase Server to get a map of nodes and their hostnames then Operator must override the internal Kubernetes DNS names.</p>
</div>
<div class="paragraph">
<p>Setting <a href="resource/couchbasecluster.html#couchbaseclusters-spec-networking-exposedfeatures" class="xref page"><code>couchbaseclusters.spec.networking.exposedFeatures</code></a> when creating a Couchbase cluster will instruct the Operator to override node mappings so that clients can connect to the correct IP address that a client can connect to.
It will also cause the Operator to create separate services that are visible external to the Kubernetes cluster.</p>
</div>
<div class="paragraph">
<p>Additionally <a href="resource/couchbasecluster.html#couchbaseclusters-spec-networking-dns-domain" class="xref page"><code>couchbaseclusters.spec.networking.dns.domain</code></a> is specified when using <a href="#public-networking-with-external-dns">Public Networking with External DNS</a>, populating the cluster node maps with DNS names and annotating the services so <a href="https://github.com/kubernetes-sigs/external-dns" target="_blank" rel="noopener">External DNS</a> can replicate this to a cloud DDNS service provider.</p>
</div>
<div class="sect2">
<h3 id="exposed-features-client-requirements"><a class="anchor" href="#exposed-features-client-requirements"></a>Supported Client Versions for use with Exposed Features</h3>
<div class="paragraph">
<p>As <a href="#public-networking-with-external-dns">Public Networking with External DNS</a> and <a href="#generic-networking">Generic Networking</a> require exposed features, clients need to be able to support this feature.
The minimum versions are specified below.</p>
</div>
<table id="table-public-connectivity" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Couchbase Clients That Support Exposed Features</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Client</th>
<th class="tableblock halign-left valign-top">Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Couchbase Server (XDCR)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.0.1+</p>
<p class="tableblock">5.5.3+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node.js SDK</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>2.5.0+</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When not using the embedded <code>libcouchbase</code> and choosing to build with an external installation, <code>libcouchbase</code> 2.9.2+ is required.
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PHP SDK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any supported version using <code>libcouchbase</code> 2.9.2+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Python SDK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any supported version using <code>libcouchbase</code> 2.9.2+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C SDK (a.k.a. <code>libcouchbase</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.9.2+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java SDK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.7.7+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET SDK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.7.9+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Go SDK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.6.1+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Couchbase Sync Gateway</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>2.7.0+ *</p>
</div>
<div class="paragraph">
<p>*Earlier versions of Sync Gateway have limited support for exposed features.
For more information, refer to <a href="#sync-gateway-exposed-features-limitations">Sync Gateway Limitations When Using Exposed Features</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Couchbase Elasticsearch Connector</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.1.0+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Couchbase Kafka Connector</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.4.5+</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A known issue exists (<a href="https://issues.couchbase.com/browse/K8S-1585" target="_blank" rel="noopener">K8S-1585</a>) where lookup may fail when using DNS SRV over TLS to connect to a Couchbase Cluster in the same Kubernetes cluster. In such cases, the workaround is to add wildcard matches to the Subject Alternate Names (SANs) as discussed in the <a href="tutorial-tls.html#creating-a-couchbase-cluster-server-certificate" class="xref page">Creating TLS Certificates</a> tutorial.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="sync-gateway-exposed-features-limitations"><a class="anchor" href="#sync-gateway-exposed-features-limitations"></a>Sync Gateway Limitations When Using Exposed Features</h4>
<div class="paragraph">
<p>Earlier versions of Sync Gateway can experience certain network limitations when connecting to a Couchbase cluster that is configured with <a href="#exposed-features">exposed features</a>.
<a href="#table-sgw-exposed-features-limitations">Table 2</a> describes the different network limitations that can occur based on the version of Sync Gateway that is being used.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Sync Gateway, like other Couchbase clients, does not require exposed features to be configured in order to establish a network connection with an instance of Couchbase Server that is running on the same local Kubernetes cluster.
The rows labeled <strong>Local</strong> in <a href="#table-sgw-exposed-features-limitations">Table 2</a> assume that you already have exposed features configured for a different purpose, e.g. exposing the admin port for remote administration, connecting to a remote cluster for XDCR, etc.
However, if you are running Sync Gateway on the same Kubernetes cluster as Couchbase Server, and there is nothing else requiring you to configure <a href="resource/couchbasecluster.html#couchbaseclusters-spec-networking-exposedfeatures" class="xref page"><code>couchbaseclusters.spec.networking.exposedFeatures</code></a> for a different purpose, then you can ignore the rest of this section as this issue will not affect you.
</td>
</tr>
</table>
</div>
<table id="table-sgw-exposed-features-limitations" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Supported Connection Methods for Sync Gateway When Using Exposed Features</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sync Gateway Version</th>
<th class="tableblock halign-left valign-top">Relationship to Cluster</th>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Connection String</th>
<th class="tableblock halign-left valign-top">High Availability</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">2.8.2+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Local</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS SRV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>couchbase://my-cluster-srv.my-namespace?network=default</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅ Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Remote</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS SRV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>couchbase://my-cluster-srv.my-namespace?network=external</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅ Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">2.8.0,<br>
2.7.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Local</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>couchbase://pod-0.my-cluster.my-namespace.svc,pod-1.my-cluster.my-namespace.svc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">🚫 No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Remote</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS SRV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>couchbase://my-cluster-srv.my-namespace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">✅ Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">&#8656; 2.7.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Local</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>couchbase://pod-0.my-cluster.my-namespace.svc,pod-1.my-cluster.my-namespace.svc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">🚫 No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Remote</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Round-robin DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>couchbase://my-cluster.my-namespace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">⚠️ Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In <a href="#table-sgw-exposed-features-limitations">Table 2</a> above, the <strong>Relationship to Cluster</strong> column indicates the location of the Sync Gateway cluster in relation to the Couchbase cluster that is being managed by the Autonomous Operator. <strong><em>Local</em></strong> refers to instances where Sync Gateway is deployed in the same Kubernetes cluster where Couchbase Server is running (see <a href="#intra-kubernetes-networking">Intra-Kubernetes Networking</a> and <a href="#inter-kubernetes-networking-with-forwarded-dns">Inter-Kubernetes Networking with Forwarded DNS</a>).
<strong><em>Remote</em></strong> refers to instances where Sync Gateway is deployed outside of the Kubernetes cluster where Couchbase Server is running (see <a href="#public-networking-with-external-dns">Public Networking with External DNS</a>).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sync Gateway 2.8.2 and higher do not experience any connection issues related to exposed features as these versions have full support for DNS SRV lookup <em>and</em> support explicit network selection.
Both <strong>Local</strong> and <strong>Remote</strong> connections can be configured in accordance with the standard client connection <a href="howto-client-sdks.html" class="xref page">documentation</a>.</p>
</li>
<li>
<p>Sync Gateway 2.7.3 and 2.8.0 introduced DNS SRV lookup for service discovery, however the automatic network selection behavior of Sync Gateway incorrectly directs traffic to "external" interfaces when running within the same Kubernetes cluster as the target Couchbase cluster.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Remote</strong> connections still work as expected and can be configured in accordance with the standard client connection <a href="howto-client-sdks.html" class="xref page">documentation</a>.</p>
</li>
<li>
<p><strong>Local</strong> connections <em>do not</em> work as expected, and Sync Gateway ends up selecting the "external" network interface.
This causes network traffic to be sent through a load balancer, which can lead to significant financial costs with a cloud provider.</p>
<div class="paragraph">
<p>If you intend to use a <strong>Local</strong> connection, you can choose to mitigate the issue by connecting using only DNS addresses.
This method requires that the connection string contain a list of the hostnames of all the Couchbase Server pods in the Couchbase cluster.
This method of connectivity is highly discouraged, as it is not tolerant to Couchbase cluster pod topology changes.
(Sync Gateway will be informed of any topology changes so long as it stays running. However, once it restarts, it will fail to reconnect because the connection string has the old topology.)</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Sync Gateway 2.7.2 and lower don&#8217;t feature DNS SRV support at all, instead falling back to a DNS address record lookup.
<strong>Local</strong> connections have the same limitations as they do in versions 2.7.3 and 2.8.0 above.
<strong>Remote</strong> connections support high availability through round-robin DNS.
(Note, however, that since this connection method runs over HTTP on port 8091, there is a potential risk of a denial of service should port 8091 ever experience too many connections at once.)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2022 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Autonomous Operator","components":["operator"],"latestVersions":{"operator":"2.3"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../_/js/site.js"></script>
<script defer src="../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
</body>
</html>
