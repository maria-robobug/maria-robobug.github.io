<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Couchbase Cluster Auto-scaling | Couchbase Docs (Local)</title>
<link rel="stylesheet" href="../../_/css/site.css">
<script src="../../_/js/vendor/jquery.js"></script>
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="operator">
<meta name="dcterms.identifier" content="2.3-beta">
<meta name="page-url" content="/operator/2.3-beta/concept-couchbase-autoscaling.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://maria-robobug.github.io/home/index.html">
                    <img src="../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://maria-robobug.github.io/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../cloud-native-database/index.html">
                      Cloud-Native
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/mariashodunke/Couchbase/docs/couchbase-operator/docs/user/modules/ROOT/pages/concept-couchbase-autoscaling.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="overview.html">Autonomous Operator</a></li>
<li class="crumb">Learn</li>
<li class="crumb">Couchbase Cluster Concepts</li>
<li class="crumb">Autoscaling</li>
<li class="crumb"><a href="concept-couchbase-autoscaling.html">Couchbase Cluster Auto-scaling</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Couchbase Cluster Auto-scaling</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
The Autonomous Operator can be configured to enable automatic scaling for Couchbase clusters.
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="about-couchbase-cluster-auto-scaling"><a class="anchor" href="#about-couchbase-cluster-auto-scaling"></a>About Couchbase Cluster Auto-scaling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Autonomous Operator provides the necessary facilities for Couchbase clusters to be automatically scaled based on usage metrics.
Thresholds can be set for native Kubernetes metrics (such as pod CPU utilization) as well as Couchbase metrics (such as bucket memory utilization) that, when crossed, trigger <em>horizontal scaling</em> of individual server classes.</p>
</div>
<div class="paragraph">
<p>Auto-scaling doesn&#8217;t incur any cluster downtime, and allows for each Couchbase Service to be scaled <em>independently</em> on the same cluster.
For example, the Data Service can automatically scale in response to fluctuations in memory utilization, while the Query Service can automatically scale in response to CPU utilization.</p>
</div>
<div class="paragraph">
<p>The sections on this page describe the conceptual information about Couchbase cluster auto-scaling.
For information on how to configure and administrate auto-scaling using the Autonomous Operator, refer to <a href="howto-couchbase-autoscaling.html" class="xref page">Configure Couchbase Cluster Auto-scaling</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Auto-scaling only supports adding or removing pod replicas of the associated server class.
Auto-scaling does not currently scale a cluster <em>vertically</em> by swapping pods with ones that have larger or smaller resource requests.
By extension, the <em>size</em> of persistent storage also cannot be auto-scaled and must be <a href="howto-persistent-volumes.html#resizing-persistent-volumes" class="xref page">manually re-sized if required</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-auto-scaling-works"><a class="anchor" href="#how-auto-scaling-works"></a>How Auto-scaling Works</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Autonomous Operator maintains Couchbase cluster topology according to the <a href="resource/couchbasecluster.html#couchbaseclusters-spec-servers" class="xref page"><code>couchbaseclusters.spec.servers</code></a> section of the <a href="resource/couchbasecluster.html" class="xref page"><code>CouchbaseCluster</code></a> resource.
Within this section, <em>server classes</em> are defined with, among other things, specifications for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The specific Couchbase Services that should run on a particular pod</p>
</li>
<li>
<p>The resources that should be assigned to that pod</p>
</li>
<li>
<p>The number of replicas of that pod that should exist in the Couchbase cluster</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example <code>CouchbaseCluster</code> Resource with Three Server Classes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: couchbase.com/v2
kind: CouchbaseCluster
metadata:
  name: cb-example
spec:
  servers:
  - name: data <i class="conum" data-value="1"></i><b>(1)</b>
    size: 3
    services:
    - data
    resources:
      limits:
        cpu: 4
        memory: 16Gi
      requests:
        cpu: 4
        memory: 16Gi
  - name: query
    size: 2
    services:
    - query
    - index</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This <em>server class</em>, named <code>data</code>, specifies that the Couchbase cluster should include <code>3</code> nodes running exclusively the Data Service, and that those nodes should each have <code>4</code> vCPU and <code>16Gi</code> memory.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This ability to have independently-configurable server classes is how the Autonomous Operator supports <a href="concept-mds.html" class="xref page"><em>Multi-Dimensional Scaling</em></a>.
Depending on the observed performance of a Couchbase cluster over time, its constituent server classes can be independently <a href="howto-couchbase-scale.html" class="xref page">scaled</a> to meet the demands of current and future workloads.</p>
</div>
<div class="paragraph">
<p><em>Auto-scaling</em> extends this capability by allowing server classes to automatically change in <code>size</code> (number of nodes) when observed metrics are detected to have crossed above or below user-configured thresholds.
The Autonomous Operator provides this capability through an integration with the Kubernetes <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/" target="_blank" rel="noopener">Horizontal Pod Autoscaler (HPA)</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/autoscale-hpa-connection.png" alt="autoscale hpa connection">
</div>
</div>
<div class="paragraph">
<p>Cluster auto-scaling is fundamentally provided by the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> custom resource created and managed by the Autonomous Operator</p>
<div class="paragraph">
<p>Refer to <a href="#about-the-couchbase-autoscaler">About the Couchbase Autoscaler</a></p>
</div>
</li>
<li>
<p>A <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> resource created and managed by the user</p>
<div class="paragraph">
<p>Refer to <a href="#about-the-horizontal-pod-autoscaler">About the Horizontal Pod Autoscaler</a></p>
</div>
</li>
<li>
<p>A metrics pipeline configured and managed by the user</p>
<div class="paragraph">
<p>Refer to <a href="#about-exposed-metrics">About Exposed Metrics</a></p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="about-the-couchbase-autoscaler"><a class="anchor" href="#about-the-couchbase-autoscaler"></a>About the Couchbase Autoscaler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Autonomous Operator creates a separate <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> custom resource for <em>each</em> server class that has auto-scaling enabled.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: couchbase.com/v2
kind: CouchbaseCluster
metadata:
  name: cb-example
spec:
  servers:
  - name: query
    autoscaleEnabled: true <i class="conum" data-value="1"></i><b>(1)</b>
    size: 2
    services:
    - query</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="resource/couchbasecluster.html#couchbaseclusters-spec-servers-autoscaleenabled" class="xref page"><code>couchbaseclusters.spec.servers.autoscaleEnabled</code></a>: Setting this field to <code>true</code> triggers the Autonomous Operator to create a <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> resource for the server class named <code>query</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> resource is named using the format <code><em>&lt;server-class&gt;</em>.<em>&lt;couchbase-cluster&gt;</em></code>.
For the example above, the Autonomous Operator would create a <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> resource named <code>query.cb-example</code>.</p>
</div>
<div class="paragraph">
<p>Once created, the Autonomous Operator keeps the size of the <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> resource in sync with the size of its associated server class.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/autoscale-crd.png" alt="autoscale crd">
</div>
</div>
<div class="paragraph">
<p>The <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> resource acts as the necessary bridge between the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> resource and the <a href="resource/couchbasecluster.html" class="xref page"><code>CouchbaseCluster</code></a> resource.
The size of a <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> resource is adjusted by the Horizontal Pod Autoscaler when the reported value of a user-specified metric crosses above or below a configured threshold.
Once the changes have been propagated from the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> resource to the <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> resource, the Autonomous Operator will observe those changes and scale the server class accordingly.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/autoscale-crd-hpa.png" alt="autoscale crd hpa">
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> custom resources are fully managed by the Autonomous Operator and should not be manually created, modified, or deleted by the user.
If one is manually deleted, the Autonomous Operator will re-create it.
However, it is possible to edit the <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> (refer to <a href="#scale-subresource">Scale Subresource</a> below).</p>
</div>
<div class="paragraph">
<p>A <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> resource only gets deleted by the Autonomous Operator when <a href="howto-couchbase-autoscaling.html#disabling-auto-scaling" class="xref page">auto-scaling is disabled</a> for the associated server class, or if the associated <a href="resource/couchbasecluster.html" class="xref page"><code>CouchbaseCluster</code></a> resource is deleted altogether.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="scale-subresource"><a class="anchor" href="#scale-subresource"></a>Scale Subresource</h3>
<div class="paragraph">
<p>The <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> implements the Kubernetes <a href="https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/#scale-subresource" target="_blank" rel="noopener">scale subresource</a>, which is what allows the <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> to be used as a target reference for <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> resources.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/autoscale-overview.png" alt="autoscale overview">
</div>
</div>
<div class="paragraph">
<p>Implementing the <code>/scale</code> subresource allows <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> resources to perform similar resizing operations to those of native Kubernetes deployments.
Therefore, manual scaling is also possible using <code>kubectl</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kubectl scale couchbaseautoscalers --replicas=6 query.cb-example</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above command results in scaling the server class named <code>query</code> to support <code>6</code> replicas.
The Autonomous Operator monitors the value of <a href="resource/couchbaseautoscaler.html#couchbaseautoscalers-spec-size" class="xref page"><code>couchbaseautoscalers.spec.size</code></a> and applies the value to <a href="resource/couchbasecluster.html#couchbaseclusters-spec-servers-size" class="xref page"><code>couchbaseclusters.spec.servers.size</code></a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Horizontal Pod Autoscaler will reconcile the number of replicas with the last computed desired state.
Manual changes to the number of replicas will be reverted if the specified size falls outside of <code>minReplicas</code> or <code>maxReplicas</code>, or if the Horizontal Pod Autoscaler is currently recommending a different size.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="about-the-horizontal-pod-autoscaler"><a class="anchor" href="#about-the-horizontal-pod-autoscaler"></a>About the Horizontal Pod Autoscaler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Autonomous Operator relies on the Kubernetes <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/" target="_blank" rel="noopener">Horizontal Pod Autoscaler (HPA)</a> to provide auto-scaling capabilities.
The Horizontal Pod Autoscaler is responsible for observing target metrics, making <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/#algorithm-details" target="_blank" rel="noopener">sizing calculations</a>, and sending sizing requests to the <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a>.</p>
</div>
<div class="paragraph">
<p>The Horizontal Pod Autoscaler is configured via a <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> resource.
The <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> resource is the primary interface by which auto-scaling is configured, and must be manually created and managed by the user.
Simply enabling auto-scaling for a server class in the <a href="resource/couchbasecluster.html" class="xref page"><code>CouchbaseCluster</code></a> resource will not result in any auto-scaling operations until a <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> resource has been manually created and configured to reference the appropriate <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> resource.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Autonomous Operator has no facility for creating or managing <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> resources.
Deleting a <a href="resource/couchbasecluster.html" class="xref page"><code>CouchbaseCluster</code></a> resource does not delete any associated <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> resources.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="referencing-the-couchbase-autoscaler"><a class="anchor" href="#referencing-the-couchbase-autoscaler"></a>Referencing the Couchbase Autoscaler</h3>
<div class="paragraph">
<p>A <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> resource needs to reference an existing <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> resource in order for auto-scaling operations to occur for the associated server class.
This is accomplished by defining the <code>scaleTargetRef</code> settings within <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscalerspec-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscalerSpec</code></a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: autoscaling/v2beta2
kind: HorizontalPodAutoscaler
metadata:
  name: query-hpa
spec:
  scaleTargetRef:
    apiVersion: couchbase.com/v2
    kind: CouchbaseAutoscaler <i class="conum" data-value="1"></i><b>(1)</b>
    name: query.cb-example <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>scaleTargetRef.kind</code>: This field must be set to <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a>, which is the <code>kind</code> of custom resource that gets automatically created by the Autonomous Operator when auto-scaling is enabled for a server class.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>scaleTargetRef.name</code>: This field needs to reference the unique <code>name</code> of the <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> custom resource.
As discussed in <a href="#about-the-couchbase-autoscaler">About the Couchbase Autoscaler</a>, <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> resources are created with the name format <code><em>&lt;server-class&gt;</em>.<em>&lt;couchbase-cluster&gt;</em></code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="target-metrics-and-thresholds"><a class="anchor" href="#target-metrics-and-thresholds"></a>Target Metrics and Thresholds</h3>
<div class="paragraph">
<p>The <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> resource must target a specific <em>metric</em>, along with an associated <em>threshold</em> for that metric.
The Horizontal Pod Autoscaler monitors the targeted metric, and when the reported value of that metric is observed to have crossed above or below the specified threshold, the Horizontal Pod Autoscaler will consider scaling the Couchbase cluster.</p>
</div>
<div class="paragraph">
<p>The <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> resource is capable of targeting any metric that is exposed to the Kubernetes API.
Target metrics can originate from a resource metric server or a custom metric server.
Refer to <a href="#about-exposed-metrics">About Exposed Metrics</a> for more information.</p>
</div>
<div class="sect3">
<h4 id="targeting-couchbase-metrics"><a class="anchor" href="#targeting-couchbase-metrics"></a>Targeting Couchbase Metrics</h4>
<div class="paragraph">
<p>The following example shows how Couchbase metrics are targeted in the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: autoscaling/v2beta2
kind: HorizontalPodAutoscaler
metadata:
  name: query-hpa
spec:
  scaleTargetRef:
    apiVersion: couchbase.com/v2
    kind: CouchbaseAutoscaler
    name: query.cb-example
  metrics:
  - type: Pods <i class="conum" data-value="1"></i><b>(1)</b>
    pods:
      metric:
        name: cbquery_requests_1000ms <i class="conum" data-value="2"></i><b>(2)</b>
      target:
        type: AverageValue <i class="conum" data-value="3"></i><b>(3)</b>
        averageValue: 7 <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>When targeting Couchbase metrics, <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#metrictarget-v2beta2-autoscaling" target="_blank" rel="noopener"><code>MetricSpec</code></a> must be set to <code>type: Pods</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#metricidentifier-v2beta2-autoscaling" target="_blank" rel="noopener"><code>MetricIdentifier</code></a> must include the name of the Couchbase metric to target for monitoring.
In this example, <code>cbquery_requests_1000ms</code> is specified, which is a metric that measures the number of requests that are exceeding 1000ms.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>When targeting Couchbase metrics, the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#metrictarget-v2beta2-autoscaling" target="_blank" rel="noopener"><code>MetricTarget</code></a> should be set to <code>type: AverageValue</code> so that the metric is averaged across all of the pods in the relevant server class.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>averageValue</code> is the value of the average of the metric across all pods in the relevant server class (as a quantity).
This is the <em>threshold</em> value that, when crossed, will trigger the Horizontal Pod Autoscaler to consider scaling the server class.
<div class="paragraph">
<p>In this example, the value has been set to <code>7</code>.
As the Horizontal Pod Autoscaler monitors the target metric (<code>cbquery_requests_1000ms</code>), it continuously takes the current sum of the reported value from each pod in the <code>query</code> server class, and divides it by the number of pods.
If the resulting value ever crosses above or below <code>7</code>, then the Horizontal Pod Autoscaler will consider scaling the number of <code>query</code> pods according to the configured policy.</p>
</div></td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="label-selectors"><a class="anchor" href="#label-selectors"></a>Label Selectors</h5>
<div class="paragraph">
<p>Some Couchbase metrics may require the use of <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/#autoscaling-on-more-specific-metrics" target="_blank" rel="noopener"><em>label selectors</em></a>.
A label selector is defined in the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#metricidentifier-v2beta2-autoscaling" target="_blank" rel="noopener"><code>MetricIdentifier</code></a> and gets passed as an additional parameter to the metrics server so that metrics can be individually scoped.</p>
</div>
<div class="paragraph">
<p>To better understand the need for label selectors, and how to use them, consider the scenario of auto-scaling the Data Service based on memory utilization.
Since each individual bucket reserves its own memory quota, it is almost never a good idea to scale the cluster based on the overall memory utilization of the Data Service.
This is because buckets are likely to reach their own individual memory quotas before that of the Data Service.
Therefore, when auto-scaling the Data Service based on memory utilization, it is better to do so based on the memory quotas of individual buckets.</p>
</div>
<div class="paragraph">
<p>The Couchbase metric for bucket memory utilization is <code>cbbucketinfo_basic_quota_user_percent</code>, and it is produced for each bucket in the cluster.
If this metric is targeted without any additional scoping, the Horizontal Pod Autoscaler will make its calculation based on the <em>sum</em> of the memory quota utilization values across <em>all buckets</em> across <em>all <code>data</code> pods</em>, which will likely cause erratic scaling behavior.
Therefore, label selectors are required for this metric to be scoped to individual buckets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: autoscaling/v2beta2
kind: HorizontalPodAutoscaler
metadata:
  name: data-hpa
spec:
  scaleTargetRef:
    apiVersion: couchbase.com/v2
    kind: CouchbaseAutoscaler
    name: data.cb-example
  metrics:
  - type: Pods
    pods:
      metric:
        name: cbbucketinfo_basic_quota_user_percent <i class="conum" data-value="1"></i><b>(1)</b>
        selector:
          matchLabels: <i class="conum" data-value="2"></i><b>(2)</b>
            bucket: travel-sample <i class="conum" data-value="3"></i><b>(3)</b>
      target:
        type: AverageValue
        averageValue: 70 <i class="conum" data-value="4"></i><b>(4)</b>
  - type: Pods
    pods:
      metric:
        name: cbbucketinfo_basic_quota_user_percent
        selector:
          matchLabels:
            bucket: default
      target:
        type: AverageValue
        averageValue: 80</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The name of the metric is defined in the same way as the <a href="#targeting-couchbase-metrics">previous example</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#metricidentifier-v2beta2-autoscaling" target="_blank" rel="noopener"><code>MetricIdentifier</code></a> is now defined with a label selector.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The label for the <code>travel-sample</code> bucket is specified, thus instructing the Horizontal Pod Autoscaler to monitor the value of <code>cbbucketinfo_basic_quota_user_percent</code> specifically for the <code>travel-sample</code> bucket.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>averageValue</code> in this example, is the average memory quota utilization of the <code>travel-sample</code> bucket across all <code>data</code> pods.
Setting a value of <code>70</code> means that the Horizontal Pod Autoscaler will auto-scale the number of <code>data</code> pods when specifically the <code>travel-sample</code> bucket crosses above or below <code>70%</code> of its individual memory quota.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="targeting-kubernetes-resource-metrics"><a class="anchor" href="#targeting-kubernetes-resource-metrics"></a>Targeting Kubernetes Resource Metrics</h4>
<div class="paragraph">
<p>The following example shows how Kubernetes resource metrics are targeted in the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: autoscaling/v2beta2
kind: HorizontalPodAutoscaler
metadata:
  name: query-hpa
spec:
  scaleTargetRef:
    apiVersion: couchbase.com/v2
    kind: CouchbaseAutoscaler
    name: query.cb-example
  metrics:
  - type: Resource <i class="conum" data-value="1"></i><b>(1)</b>
    resource:
      name: cpu <i class="conum" data-value="2"></i><b>(2)</b>
      target:
        type: Utilization <i class="conum" data-value="3"></i><b>(3)</b>
        averageUtilization: 70 <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>When targeting Kubernetes resource metrics, <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#metrictarget-v2beta2-autoscaling" target="_blank" rel="noopener"><code>MetricSpec</code></a> must be set to <code>type: Resource</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#resourcemetricsource-v2beta2-autoscaling" target="_blank" rel="noopener"><code>ResourceMetricSource</code></a> must include the name of the Kubernetes resource metric (e.g. <code>cpu</code> and <code>memory</code>) to target for monitoring.
In this example, <code>cpu</code> is specified, which is a metric that measures the pod CPU usage as a percentage.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>When targeting Kubernetes resource metrics, the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#metrictarget-v2beta2-autoscaling" target="_blank" rel="noopener"><code>MetricTarget</code></a> should be set to <code>type: Utilization</code> so that the metric is averaged across all of the pods in the relevant server class.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>averageUtilization</code> the value of the average of the resource metric across all pods in the relevant server class, represented as a percentage of the requested value of the resource for the pods.
This is the <em>threshold</em> value that, when crossed, will trigger the Horizontal Pod Autoscaler to consider scaling the server class.
In this example, the value has been set to <code>70</code>.
As the Horizontal Pod Autoscaler monitors the target metric (<code>cpu</code>), it continuously takes the current sum of the reported value from each pod in the <code>query</code> server class, and divides it by the number of pods.
If resulting value ever crosses above or below <code>70</code>, then the Horizontal Pod Autoscaler will consider scaling the number of <code>query</code> pods.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sizing-constraints"><a class="anchor" href="#sizing-constraints"></a>Sizing Constraints</h3>
<div class="paragraph">
<p>The Horizontal Pod Autoscaler applies constraints to the sizing values that are allowed to be propagated to the <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> resource.
Specifically, defining <code>minReplicas</code> and <code>maxReplicas</code> within the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscalerspec-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscalerSpec</code></a> sets lower and upper boundaries for the size of the server class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: autoscaling/v2beta2
kind: HorizontalPodAutoscaler
metadata:
  name: query-hpa
spec:
  minReplicas: 2 <i class="conum" data-value="1"></i><b>(1)</b>
  maxReplicas: 6 <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>minReplicas</code>: This field sets the minimum number of Couchbase nodes for the relevant server class, and defaults to <code>1</code>.
In this example, the value is set to <code>2</code>, which means that the number of Couchbase nodes in the <code>query</code> server class will never be down-scaled to fewer than two nodes, even if the Horizontal Pod Autoscaler detects that the value for the target metric is below the target threshold.
<div class="paragraph">
<p>Setting <code>minReplicas</code> is important for maintaining service availability.
Refer to <a href="concept-couchbase-autoscaling-best-practices.html" class="xref page">Couchbase Cluster Auto-scaling Best Practices</a> for additional guidance on setting this value in production environments.</p>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>maxReplicas</code>: This field sets the maximum number of Couchbase nodes for the relevant server class.
This field is <em>required</em> and it cannot be set to a value lower than what is defined for <code>minReplicas</code>.
In this example, the value is set to <code>6</code>, which means that the number of Couchbase nodes in the <code>query</code> server class will never be up-scaled to greater than six nodes, even if the Horizontal Pod Autoscaler detects that the value for the target metric is above the target threshold.
<div class="paragraph">
<p>Setting a value for <code>maxReplicas</code> is important because it provides important protection against runaway scaling events.
Refer to <a href="concept-couchbase-autoscaling-best-practices.html" class="xref page">Couchbase Cluster Auto-scaling Best Practices</a> for additional guidance on setting this value in production environments.</p>
</div></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Refer to the  <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/#algorithm-details" target="_blank" rel="noopener">algorithm details</a> of the Horizontal Pod Autoscaler for additional information about how scaling decisions are determined.</p>
</div>
</div>
<div class="sect2">
<h3 id="scaling-behavior"><a class="anchor" href="#scaling-behavior"></a>Scaling Behavior</h3>
<div class="paragraph">
<p>The Horizontal Pod Autoscaler provides fine-grained controls for configuring behaviors for scaling up and down.
These behaviors are configured via <em>policies</em> specified in the <code>behavior</code> field in the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscalerspec-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscalerSpec</code></a>.</p>
</div>
<div class="paragraph">
<p>The following subsections describe some of the more relevant details related to configuring scaling behavior.
For additional information and examples, refer to the Kubernetes documentation related to <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/#scaling-policies" target="_blank" rel="noopener">scaling policies</a>.</p>
</div>
<div class="sect3">
<h4 id="scaling-policies"><a class="anchor" href="#scaling-policies"></a>Scaling Policies</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  behavior:
    scaleUp: <i class="conum" data-value="1"></i><b>(1)</b>
      policies:
      - type: Pods <i class="conum" data-value="2"></i><b>(2)</b>
        value: 1 <i class="conum" data-value="3"></i><b>(3)</b>
        periodSeconds: 15 <i class="conum" data-value="4"></i><b>(4)</b>
      selectPolicy: Max <i class="conum" data-value="5"></i><b>(5)</b>
    scaleDown:
      policies:
      - type: Percent
        value: 100
        periodSeconds: 15</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Policies can be specified under <code>scaleUp</code> or <code>scaleDown</code>.
More than one policy can be specified, but a minimum of one policy is required for each action (unless policy selection is <a href="#disable-down-scaling">explicitly disabled</a>).
If no user-supplied values are specified in the policy fields, then the <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/#default-behavior" target="_blank" rel="noopener">default values</a> are used.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The policy <code>type</code> can be <code>Pods</code> or <code>Percent</code>.
Note that for <code>scaleUp</code> policies, the <code>Pods</code> type is recommended for Couchbase.
Refer to <a href="#scaling-increments">Scaling Increments</a> for more information.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Depending on the policy <code>type</code>, the <code>value</code> field represents either an absolute number of pods or a percentage of pods.
Note that for <code>scaleUp</code> policies with <code>type: Pods</code>, the recommended setting is <code>1</code>.
Refer to <a href="#scaling-increments">Scaling Increments</a> for more information.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>periodSeconds</code> field defines the length of time in the past for which the policy must hold true before successive scaling changes in the same direction are allowed to occur.
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>periodSeconds</code> setting is effectively unnecessary when it comes to auto-scaling Couchbase clusters with the Autonomous Operator, and should be left to its default value unless recommended otherwise by the <a href="concept-couchbase-autoscaling-best-practices.html" class="xref page">Couchbase Cluster Auto-scaling Best Practices</a>.
Instead, <a href="#horizontal-pod-stabilization">Horizontal Pod Stabilization</a> should be used, as it is the preferred method for controlling successive changes in scaling direction.
</td>
</tr>
</table>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>selectPolicy</code> field controls which policy is chosen by the Horizontal Pod Autoscaler if more than one policy is defined.
When set to <code>Min</code>, the Horizontal Pod Autoscaler selects the policy which allows the smallest change in the replica count.
When set to <code>Max</code> (the default), the Horizontal Pod Autoscaler selects the policy which allows the greatest change in the replica count.
<div id="disable-down-scaling" class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Disable Down-scaling</div>
<div class="paragraph">
<p>The Horizontal Pod Autoscaler can be prevented from ever scaling down a server class by disabling policy selection for <code>scaleDown</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  behavior:
    scaleDown:
      selectPolicy: Disabled</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div></td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The Autonomous Operator can only auto-scale one server class at a time.
This is an important point to consider when enabling auto-scaling for multiple server classes on the same Couchbase cluster.
If any associated <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> resource makes a new scaling recommendation while the cluster is currently undergoing a scaling operation based on a previous recommendation, then the new recommendation will not be honored until the current scaling operation is complete.
For example, in a hypothetical scenario where the Autonomous Operator has already begun scaling up a server class named <code>data</code> when another <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> resource recommends scaling up a server class named <code>query</code> on the same cluster, the Autonomous Operator will not balance in any <code>query</code> replicas until the <code>data</code> server class has been scaled up to the desired size.
(Note that this scenario is only possible when the <a href="#couchbase-stabilization-period">Couchbase Stabilization Period</a> is disabled.)
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="scaling-increments"><a class="anchor" href="#scaling-increments"></a>Scaling Increments</h4>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
It is possible to configure <a href="#scaling-policies">scaling policies</a> for <code>scaleUp</code> and <code>scaleDown</code> that allow for scaling in increments of greater than one replica.
(In fact, the <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/#default-behavior" target="_blank" rel="noopener">default policies</a> of the Horizontal Pod Autoscaler allow for this.)
However, scaling up in increments of more than one replica is unlikely if sensible metrics/thresholds are set.
Therefore, this section is provided primarily for information purposes.
Though, it is still recommended to explicitly set the <code>scaleUp</code> increment to <code>1</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>value</code> specified in the policy determines the maximum change in number of replicas that the Horizontal Pod Autoscaler can recommend in a single operation.
For example, if a pod <code>scaleUp</code> policy is set to <code>value: 2</code>, the Horizontal Pod Autoscaler is allowed to increase the size of the server class by up to two additional replicas in a single operation (e.g. from <code>size: 2</code> to <code>size: 3</code>, or from <code>size: 2</code> to <code>size: 4</code>).
The change in number of replicas being recommended by the Horizontal Pod Autoscaler is known as the <em>scaling increment</em>.</p>
</div>
<div class="paragraph">
<p>It&#8217;s important to remember that the Horizontal Pod Autoscaler makes recommendations by setting the <em>target size</em> for the server class.
For example, if the server class is currently running at <code>size: 2</code>, and the Horizontal Pod Autoscaler recommends scaling up by two additional replicas, the Horizontal Pod Autoscaler will institute its recommendation by setting the relevant <a href="resource/couchbaseautoscaler.html" class="xref page"><code>CouchbaseAutoscaler</code></a> resource directly to <code>size: 4</code>.</p>
</div>
<div class="paragraph">
<p>However, it is recommended that <code>scaleUp</code> policies be configured to only allow scaling in increments of <em>one</em> replica.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  behavior:
    scaleUp:
      policies:
      - type: Pods
        value: 1 <i class="conum" data-value="1"></i><b>(1)</b>
        periodSeconds: 15</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This policy specifies that the Horizontal Pod Autoscaler will only make scale-up recommendations in increments of one replica.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Configuring the Horizontal Pod Autoscaler to scale up the server class by increments of one replica allows the targeted metric more opportunity to stabilize under the target threshold with less risk of over-scaling and causing additional rebalances.
Before considering scaling up by larger increments, greater importance should be placed on identifying the most relevant <a href="#target-metrics-and-thresholds">metric and threshold</a> for a given application, and then testing it under simulated workloads to confirm whether a larger scaling increment is called for.</p>
</div>
<div class="paragraph">
<p>The scaling increment does not have the same ramifications when scaling down as when scaling up.
Therefore it is recommended to keep the default <code>scaleDown</code> settings unless testing shows that non-default settings are needed.</p>
</div>
<div class="paragraph">
<p>Refer to <a href="concept-couchbase-autoscaling-best-practices.html" class="xref page">Couchbase Cluster Auto-scaling Best Practices</a> for help with identifying appropriate baseline metrics and thresholds.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="stabilization-windows"><a class="anchor" href="#stabilization-windows"></a>Stabilization Windows</h3>
<div class="paragraph">
<p>If the targeted metric fluctuates back and forth across the configured scaling threshold over a short period of time, it can cause the cluster to scale up and down unnecessarily as it chases after the metric.
This behavior is sometimes referred to as "flapping" or "thrashing".</p>
</div>
<div class="paragraph">
<p>The Horizontal Pod Autoscaler and the Autonomous Operator <em>both</em> provide different but equally important mechanisms to control the flapping of pod replicas.
These controls, described in the subsections below, are meant to be used in tandem with each other, and should be tested using different permutations when determining the appropriate auto-scaling configuration for a particular workload.</p>
</div>
<div class="sect3">
<h4 id="couchbase-stabilization-period"><a class="anchor" href="#couchbase-stabilization-period"></a>Couchbase Stabilization Period</h4>
<div class="paragraph">
<p>Both during and directly after a rebalance operation, some metrics may behave erratically while the cluster continues to stabilize.
If the Horizontal Pod Autoscaler is monitoring a targeted metric that is unstable due to rebalance, it may lead the Horizontal Pod Autoscaler to erroneously scale the cluster in undesirable ways.</p>
</div>
<div class="paragraph">
<p>The <em>Couchbase Stabilization Period</em> is an internal safety mechanism provided by the Autonomous Operator that is meant to help prevent the types of over-scaling caused by metrics instability during rebalance.
When the Couchbase Stabilization Period is specified, the Autonomous Operator will put <em>all</em> <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> resources associated with the Couchbase cluster into <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/#implicit-maintenance-mode-deactivation" target="_blank" rel="noopener"><em>maintenance mode</em></a> during rebalance operations.
When in maintenance mode, the Horizontal Pod Autoscaler will not monitor targeted metrics, and therefore will stop making scaling recommendations.
Once the rebalance operation is complete, the Horizontal Pod Autoscaler will remain in maintenance mode for the duration of the stabilization period, after which it will resume monitoring metrics.</p>
</div>
<div class="paragraph">
<p>The Couchbase Stabilization Period is specified in the <a href="resource/couchbasecluster.html" class="xref page"><code>CouchbaseCluster</code></a> resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: couchbase.com/v2
kind: CouchbaseCluster
metadata:
  name: cb-example
spec:
  autoscaleStabilizationPeriod: 30s <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="resource/couchbasecluster.html#couchbaseclusters-spec-autoscalestabilizationperiod" class="xref page"><code>couchbaseclusters.spec.autoscaleStabilizationPeriod</code></a>: When set to <code>0s</code>, <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> resources will exit maintenance mode as soon as the cluster finishes rebalancing.
When set to a value greater than <code>0s</code>, <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> resources will remain in maintenance mode for the specified amount of time after rebalance is complete.
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When left unset, this field defaults to <code>null</code>.
When set to <code>null</code>, <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> resources will only be put in maintenance mode while the cluster is <em>pending</em> a rebalance.
Once the cluster starts actively rebalancing, <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> resources will exit maintenance mode.
</td>
</tr>
</table>
</div></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is important to note that once the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> is reactivated that it will immediately access the targeted metrics and compare thresholds to determine if further scaling is required.
Another thing to keep in mind is that the Couchbase Stabilization Period forces <em>all</em> <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#horizontalpodautoscaler-v2beta2-autoscaling" target="_blank" rel="noopener"><code>HorizontalPodAutoscaler</code></a> resources associated with the Couchbase cluster into maintenance mode.
Therefore all server classes that have auto-scaling enabled will not be subject to scaling during this period.</p>
</div>
<div class="paragraph">
<p>In most scenarios, the native <a href="#horizontal-pod-stabilization">stabilization windows</a> provided by the Horizontal Pod Autoscaler should provide the necessary controls for restricting the flapping of replicas.
In general, the Couchbase Stabilization Period should only be used when the cluster needs additional time to stabilize <em>after</em> rebalance, or if the target metric can be adversely affected <em>during</em> rebalance (such as CPU and network I/O metrics).
Refer to <a href="concept-couchbase-autoscaling-best-practices.html" class="xref page">Couchbase Cluster Auto-scaling Best Practices</a> for additional guidance on setting this value in production environments.</p>
</div>
</div>
<div class="sect3">
<h4 id="horizontal-pod-stabilization"><a class="anchor" href="#horizontal-pod-stabilization"></a>Horizontal Pod Stabilization</h4>
<div class="paragraph">
<p>The Horizontal Pod Autoscaler provides a configurable <em>stabilization window</em> as a method to control undesirable scaling caused by fluctuating metrics.</p>
</div>
<div class="paragraph">
<p>When the Horizontal Pod Autoscaler calculates whether to scale the cluster, it looks backward in time at all of the previously desired sizes that were computed during the specified stabilization window and picks the largest value to use when computing the new desired size.</p>
</div>
<div class="paragraph">
<p>A stabilization window can be configured for both <code>scaleUp</code> and <code>scaleDown</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  behavior:
    scaleUp:
      stabilizationWindowSeconds: 30 <i class="conum" data-value="1"></i><b>(1)</b>
      policies:
      - type: Pods
        value: 1
        periodSeconds: 15
    scaleDown:
      stabilizationWindowSeconds: 300 <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In this example, when the target metric indicates that the cluster should scale up, the Horizontal Pod Autoscaler will consider all desired states in the past 30 seconds.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In this example, when the target metric indicates that the cluster should scale down, the Horizontal Pod Autoscaler will consider all desired states in the past 5 minutes.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If no stabilization window is specified for <code>scaleUp</code> or <code>scaleDown</code>, the Horizontal Pod Autoscaler uses a <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/#default-behavior" target="_blank" rel="noopener">default value</a>.
The default <code>scaleDown</code> stabilization window works well enough for most use-cases, and should not need to be modified.
However, the default value for <code>scaleUp</code> is <code>0</code>, which is not ideal.
A minimum <code>scaleUp</code> stabilization window of 30 seconds is generally recommended, unless indicated otherwise in <a href="concept-couchbase-autoscaling-best-practices.html" class="xref page">Couchbase Cluster Auto-scaling Best Practices</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="about-exposed-metrics"><a class="anchor" href="#about-exposed-metrics"></a>About Exposed Metrics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Metrics play the most important role in Couchbase cluster auto-scaling.
Metrics provide the means for the Horizontal Pod Autoscaler to measure cluster performance and respond accordingly when target thresholds are crossed.
The Horizontal Pod Autoscaler can only monitor metrics through the Kubernetes API, therefore metrics affecting the Couchbase cluster must be exposed within the Kubernetes cluster in order to provide auto-scaling capabilities.</p>
</div>
<div class="sect2">
<h3 id="resource-metrics"><a class="anchor" href="#resource-metrics"></a>Resource Metrics</h3>
<div class="paragraph">
<p>Resource metrics such as <code>cpu</code> and <code>memory</code> from pods and nodes are collected by <a href="https://github.com/kubernetes-sigs/metrics-server" target="_blank" rel="noopener">Metrics Server</a>, and exposed through the Kubernetes <a href="https://kubernetes.io/docs/tasks/debug-application-cluster/resource-metrics-pipeline/#the-metrics-api" target="_blank" rel="noopener">Metrics API</a>.
Metrics Server may not be deployed by default in your Kubernetes cluster.</p>
</div>
<div class="paragraph">
<p>You can run the following command to check if Metrics Server is properly installed and exposing the necessary resource metrics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kubectl get --raw /apis/metrics.k8s.io/v1beta1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The response should contain an <code>APIResourceList</code> with the type of resources that can be fetched.
If you receive a <code>NotFound</code> error, then you&#8217;ll need to <a href="https://github.com/kubernetes-sigs/metrics-server#installation" target="_blank" rel="noopener">install Metrics Server</a> if you plan on performing auto-scaling based on resource metrics.</p>
</div>
</div>
<div class="sect2">
<h3 id="couchbase-metrics"><a class="anchor" href="#couchbase-metrics"></a>Couchbase Metrics</h3>
<div class="paragraph">
<p>Couchbase metrics need to be exposed through the Kubernetes <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/#support-for-custom-metrics" target="_blank" rel="noopener">custom metrics API</a> in order to use them for auto-scaling.
This is a requirement if you wish to use metrics like memory quota and query latency as targets to determine when auto-scaling should occur.</p>
</div>
<div class="paragraph">
<p>Couchbase metrics are collected by the <a href="howto-prometheus.html" class="xref page">Couchbase Prometheus Exporter</a>.
The cluster must have <a href="resource/couchbasecluster.html#couchbaseclusters-spec-monitoring-prometheus-enabled" class="xref page"><code>couchbaseclusters.spec.monitoring.prometheus.enabled</code></a> set to <code>true</code> in order for Couchbase metrics to be collected by the custom metrics API service.</p>
</div>
<div class="paragraph">
<p>You can run the following command to verify that your cluster is capable of performing auto-scaling based on custom metrics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kubectl get --raw /apis/custom.metrics.k8s.io/v1beta1</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you receive a <code>NotFound</code> error then you will need to install a custom metrics service.
The recommended custom metrics service to use with the Autonomous Operator is the <a href="https://github.com/DirectXMan12/k8s-prometheus-adapter" target="_blank" rel="noopener">Prometheus Adapter</a>.</p>
</div>
<div class="paragraph">
<p>When performing auto-scaling based on Couchbase Server metrics, the discovery of available metrics can be performed through Prometheus queries that are beyond the scope of this document.
However, the Couchbase Exporter repository contains a <a href="https://github.com/couchbase/couchbase-exporter/blob/master/example/config.json" target="_blank" rel="noopener">list of the Couchbase metrics being exported</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="about-the-kubernetes-cluster-autoscaler"><a class="anchor" href="#about-the-kubernetes-cluster-autoscaler"></a>About the Kubernetes Cluster Autoscaler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler" target="_blank" rel="noopener">Kubernetes Cluster Autoscaler</a> provides the means to automatically scale the underlying Kubernetes cluster.
Automatically scaling the Kubernetes cluster is recommended for production deployments as it adds an additional dimension of scalability for adding and removing pods because the underlying physical hardware is being scaled alongside of the Couchbase cluster.
Also, since production deployments tend to schedule pods with specific resource limits and requests with performance expectations, Kubernetes cluster auto-scaling more easily allows for 1-to-1 matching of Couchbase pods with the underlying Kubernetes worker nodes without concern that a worker node is sharing resources with several Couchbase pods.</p>
</div>
<div class="paragraph">
<p>Couchbase cluster auto-scaling will work with Kubernetes cluster auto-scaling without any additional configuration.
As the Horizontal Pod Autoscaler requests additional Couchbase pods, resource pressure will be applied (or removed) from Kubernetes, and Kubernetes will automatically add (or remove) the number of required physical worker nodes.
The following tutorial provides a good explanation of how to use the Kubernetes Cluster Autoscaler: <a href="https://learnk8s.io/kubernetes-autoscaling-strategies" class="bare" target="_blank" rel="noopener">https://learnk8s.io/kubernetes-autoscaling-strategies</a></p>
</div>
<div class="paragraph">
<p>Several managed Kubernetes services such as EKS and AKS offer Kubernetes cluster auto-scaling.
Refer to the Kubernetes Cluster Autoscaler <a href="https://github.com/kubernetes/autoscaler/tree/master/cluster-autoscaler#faqdocumentation" target="_blank" rel="noopener">FAQ</a> for additional information about cloud providers that offer Kubernetes cluster auto-scaling.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-links"><a class="anchor" href="#related-links"></a>Related Links</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>Learn</strong>: <a href="concept-couchbase-autoscaling-best-practices.html" class="xref page">Couchbase Cluster Auto-scaling Best Practices</a></p>
</li>
<li>
<p><strong>Manage</strong>: <a href="howto-couchbase-autoscaling.html" class="xref page">Configure Couchbase Cluster Auto-scaling</a></p>
</li>
<li>
<p><strong>Tutorial</strong>: <a href="tutorial-autoscale-query.html" class="xref page">Auto-scaling the Couchbase Query Service</a></p>
</li>
<li>
<p><strong>Tutorial</strong>: <a href="tutorial-autoscale-data.html" class="xref page">Auto-scaling the Couchbase Data Service</a></p>
</li>
<li>
<p><strong>Tutorial</strong>: <a href="tutorial-autoscale-index.html" class="xref page">Auto-scaling the Couchbase Index Service</a></p>
</li>
<li>
<p><strong>Reference</strong>: <a href="resource/couchbaseautoscaler.html" class="xref page">CouchbaseAutoscaler Resource</a></p>
</li>
<li>
<p><strong>Reference</strong>: <a href="reference-couchbasecluster-events.html#autoscaling-lifecycle" class="xref page">Auto-scaling Lifecycle Events</a></p>
</li>
</ul>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2022 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Autonomous Operator","components":["operator"],"latestVersions":{"operator":"2.3-beta"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../_/js/site.js"></script>
<script defer src="../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
</body>
</html>
