<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Full Text Search | Couchbase Docs (Local)</title>
<link rel="canonical" href="https://maria-robobug.github.io/kotlin-sdk/1.0/howtos/full-text-search.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="You can use the Full Text Search (FTS) service to find JSON documents that have certain words, phrases, or geographic coordinates.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="kotlin-sdk">
<meta name="dcterms.identifier" content="1.0">
<meta name="page-url" content="/kotlin-sdk/1.0/howtos/full-text-search.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://maria-robobug.github.io/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://maria-robobug.github.io/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="2">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/mariashodunke/Couchbase/docs/docs-sdk-kotlin//modules/howtos/pages/full-text-search.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../hello-world/overview.html">Kotlin SDK</a></li>
<li class="crumb"><a href="full-text-search.html">Full Text Search</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Full Text Search</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
You can use the Full Text Search (FTS) service to find JSON documents that have certain words, phrases, or geographic coordinates.
</blockquote>
</div>
<div class="paragraph">
<p>The Full Text Search (FTS) service finds JSON documents that have certain words, phrases, or geographic coordinates.
It can also search numeric and date/time fields.</p>
</div>
<div class="paragraph">
<p>When searching for words and phrases, you can look for an exact match or similar words (like "beauty" and "beautiful").
For numbers and dates, you can look for values in a range.
For geographic coordinates, you can look for values near a location or within a region.</p>
</div>
<div class="paragraph">
<p>For all kinds of FTS searches, you can ask the server to count the number of matching documents that belong to different categories, called "facets."</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Before You Start</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You should know <a href="../../../server/7.1/fts/fts-creating-indexes.html" class="xref page">how to create a Full Text Search index</a>.</p>
</div>
<div class="paragraph">
<p>You should know <a href="connecting.html" class="xref page">how to connect to a Couchbase cluster</a>.</p>
</div>
<div class="paragraph">
<p>The examples on this page use the <code>travel-sample</code> and <code>beer-sample</code> <a href="../../../server/7.1/manage/manage-settings/install-sample-buckets.html" class="xref page">sample buckets</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="simple-example"><a class="anchor" href="#simple-example"></a>A Simple FTS Search</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This example searches for documents that have the word "pool" in one of the indexed fields.</p>
</div>
<div class="paragraph">
<p>If you want to run this example, first create an index called <code>travel-sample-index</code> on the <code>travel-sample</code> bucket.
Then run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" data-source-url="file:///Users/mariashodunke/Couchbase/docs/docs-sdk-kotlin//modules/howtos/examples/FullTextSearch.kt#L34-L44">val searchResult: SearchResult = cluster
    .searchQuery(
        indexName = "travel-sample-index",
        query = SearchQuery.queryString("pool"), <i class="conum" data-value="1"></i><b>(1)</b>
    )
    .execute() <i class="conum" data-value="2"></i><b>(2)</b>

searchResult.rows.forEach { row: SearchRow -&gt;
    println("Document ${row.id} has score ${row.score}")
    println(row)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The argument to <code>queryString</code> uses the same syntax as when you search an index using the Couchbase web UI.
<code>SearchQuery</code> has other companion factory methods for doing different kinds of searches.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>searchQuery</code> method returns a <code>Flow&lt;SearchFlowItem&gt;</code>.
Nothing happens until you collect the flow.
Calling <code>execute</code> is an easy way to collect the flow.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-types"><a class="anchor" href="#query-types"></a>Queries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The FTS service can do <a href="../../../server/7.1/fts/fts-supported-queries.html" class="xref page">many kinds of queries</a>.
The Kotlin SDK&#8217;s <code>SearchQuery</code> class has a companion factory method for each kind of query.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="result-rows"><a class="anchor" href="#result-rows"></a>Result Rows</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each matching document is returned as a <code>SearchRow</code>.
By default, a <code>SearchRow</code> only has a document ID, a score, and the name of the FTS index partition it came from.
The <code>searchQuery</code> method has optional parameters that let you request more information about the matching document.</p>
</div>
<div class="sect2">
<h3 id="score"><a class="anchor" href="#score"></a>Score</h3>
<div class="paragraph">
<p>The server gives each row a numeric score.
A higher score means the row is a better match.</p>
</div>
<div class="sect3">
<h4 id="explain-score"><a class="anchor" href="#explain-score"></a>Explain the score</h4>
<div class="paragraph">
<p>If you want to know how the server calculated the score, pass <code>explain = true</code> when calling <code>searchQuery</code>, like this:</p>
</div>
<div class="listingblock">
<div class="title">Explain scoring</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" data-source-url="file:///Users/mariashodunke/Couchbase/docs/docs-sdk-kotlin//modules/howtos/examples/FullTextSearch.kt#L96-L107">val searchResult: SearchResult = cluster
    .searchQuery(
        indexName = "travel-sample-index",
        query = SearchQuery.queryString("pool"),
        explain = true, <i class="conum" data-value="1"></i><b>(1)</b>
    )
    .execute()

searchResult.rows.forEach { row -&gt;
    println(String(row.explanation)) <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This line tells the server you want to know how each score is calculated.
If you don&#8217;t do this, <code>row.explanation</code> is an empty ByteArray.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>row.explanation</code> is a ByteArray holding a JSON Object.
This example just prints it, but you can parse it as JSON if you want.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="disable-score"><a class="anchor" href="#disable-score"></a>Disable scoring</h4>
<div class="paragraph">
<p>Calculating the score takes time.
If you don&#8217;t need the score, tell the server to give each row a score of zero, like this:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Disabling scoring requires Couchbase Server 6.6.1 or later.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Disable scoring</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" data-source-url="file:///Users/mariashodunke/Couchbase/docs/docs-sdk-kotlin//modules/howtos/examples/FullTextSearch.kt#L114-L120">val searchResult: SearchResult = cluster
    .searchQuery(
        indexName = "travel-sample-index",
        query = SearchQuery.queryString("pool"),
        score = Score.none(), <i class="conum" data-value="1"></i><b>(1)</b>
    )
    .execute()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This line tells the server you don&#8217;t care about scores.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fields"><a class="anchor" href="#fields"></a>Fields</h3>
<div class="paragraph">
<p>By default, the server does not return any document content.
You can tell the server to return stored document fields.
Pass <code>fields = listOf("*")</code> when calling <code>searchQuery</code> to include all stored fields in the result.
If you only want fields "foo" and "bar", pass <code>fields = listOf("foo", "bar")</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Only stored fields are included.
If you&#8217;re not getting the results you expect, check the index definition.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Include stored fields in result rows</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" data-source-url="file:///Users/mariashodunke/Couchbase/docs/docs-sdk-kotlin//modules/howtos/examples/FullTextSearch.kt#L127-L137">val searchResult: SearchResult = cluster
    .searchQuery(
        indexName = "travel-sample-index",
        query = SearchQuery.queryString("pool"),
        fields = listOf("*"), <i class="conum" data-value="1"></i><b>(1)</b>
    )
    .execute()

searchResult.rows.forEach { row -&gt;
    println(row.fieldsAs&lt;Map&lt;String, Any?&gt;&gt;()) <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This line tells the server you want the result rows to include <em>all</em> stored fields.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>row.fields</code> is a ByteArray holding a JSON object that has the requested fields.
The <code>row.fieldsAs&lt;T&gt;</code> method uses data binding to convert the JSON into an instance of <code>T?</code> (in this case, a Kotlin Map).
<div class="paragraph">
<p>If you want, you can convert the fields into an instance of a user-defined class instead of a Map.
See <a href="json.html" class="xref page">Working with JSON</a> for more information about data binding.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If all requested fields are missing or unstored, and you&#8217;re not searching a multi-collection index, <code>row.fields</code> is null and <code>row.fieldsAs&lt;T&gt;</code> returns null.
</td>
</tr>
</table>
</div></td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="collections"><a class="anchor" href="#collections"></a>Collections</h3>
<div class="paragraph">
<p>Couchbase 7.0 and later let you define an index on multiple collections in the same scope.
You can limit the search to specific collections using the optional <code>collections</code> parameter of the <code>searchQuery</code> method.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When searching a multi-index collection, the server always returns a field called <code>_$c</code>.
The value of this field is the name of the matching document&#8217;s parent collection.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" data-source-url="file:///Users/mariashodunke/Couchbase/docs/docs-sdk-kotlin//modules/howtos/examples/FullTextSearch.kt#L143-L155">val searchResult: SearchResult = cluster
    .searchQuery(
        indexName = "travel-sample-multi-collection-index",
        query = SearchQuery.queryString("San Francisco"),
        collections = listOf("airport", "landmark") <i class="conum" data-value="1"></i><b>(1)</b>
    )
    .execute()

searchResult.rows.forEach { row -&gt;
    val fields = row.fieldsAs&lt;Map&lt;String, Any?&gt;&gt;()
    val collection = fields?.get("_\$c") <i class="conum" data-value="2"></i><b>(2)</b>
    println("Found document ${row.id} in collection $collection")
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The server only searches in these collections</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>_$c</code> field is always present when searching a multi-collection index.</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Be careful when using <a href="#keyset-pagination">keyset pagination</a> with a multi-collection index.
Documents in different collections can have the same ID, so sorting by ID does not necessarily guarantee a total ordering of the results.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="highlight"><a class="anchor" href="#highlight"></a>Highlight (fragments)</h3>
<div class="paragraph">
<p>You can ask the server to include a fragment of a matching field value, and highlight the search term within the fragment.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Highlighting requires storing the field value and including term vectors.
If you&#8217;re not getting the results you expect, check the index definition.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Highlight matches</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" data-source-url="file:///Users/mariashodunke/Couchbase/docs/docs-sdk-kotlin//modules/howtos/examples/FullTextSearch.kt#L161-L172">val searchResult: SearchResult = cluster
    .searchQuery(
        indexName = "travel-sample-index",
        query = SearchQuery.queryString("pool"),
        highlight = Highlight.html() <i class="conum" data-value="1"></i><b>(1)</b>
    )
    .execute()

searchResult.rows.forEach { row -&gt;
    println(row.locations) <i class="conum" data-value="2"></i><b>(2)</b>
    println(row.fragments) <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This line tells the server you want the result to include fragments, and you want the matching text to be wrapped in HTML tags, like this: <code>&lt;mark&gt;pool&lt;/mark&gt;</code>.
Alternatively, you can use <code>Highlight.ansi()</code> to mark the matches using ANSI escape codes.
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>Highlight.html</code> and <code>ansi</code> methods have an optional <code>fields</code> parameter that limits highlighting to only the fields you specify.
</td>
</tr>
</table>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>When you request highlighting, the server also tells you the location of the matched text within the field.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>row.fragments</code> property is a <code>Map&lt;String, List&lt;String&gt;&gt;</code>.
Each key is name of a field where a search term was found.
The value is a list of fragments of the field text, with the search term highlighted.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="locations"><a class="anchor" href="#locations"></a>Locations</h3>
<div class="paragraph">
<p>When you request  <a href="#highlight">highlighting</a>, the server also return the locations of the matched terms within the field value.
The <code>SearchRow.locations</code> property is a list of <code>SearchLocation</code> objects.</p>
</div>
<div class="paragraph">
<p>If you want the location information, but don&#8217;t need fragments, pass <code>includeLocations = true</code> when calling <code>searchQuery</code> instead of passing a value for <code>highlight</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To get locations, the index must include term vectors for the field.
If you&#8217;re not getting the results you expect, check the index definition.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sorting"><a class="anchor" href="#sorting"></a>Sorting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, result rows are sorted by score, from highest to lowest.
Use the <code>sort</code> parameter to tell the server to sort the rows differently.</p>
</div>
<div class="paragraph">
<p>This example sorts the results by the value of the "country" field:</p>
</div>
<div class="listingblock">
<div class="title">Sort by <code>country</code> field</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" data-source-url="file:///Users/mariashodunke/Couchbase/docs/docs-sdk-kotlin//modules/howtos/examples/FullTextSearch.kt#L179-L185">val searchResult: SearchResult = cluster
    .searchQuery(
        indexName = "travel-sample-index",
        query = SearchQuery.queryString("pool"),
        sort = SearchSort.byField("country"), <i class="conum" data-value="1"></i><b>(1)</b>
    )
    .execute()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>byField</code> also has optional parameters.
We will talk about them next.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>SearchSort</code> has companion factory methods for creating <code>SearchSort</code> objects.
These objects tell the server how to sort the results.</p>
</div>
<div class="sect2">
<h3 id="sorting-by-field"><a class="anchor" href="#sorting-by-field"></a>Sorting by field value</h3>
<div class="paragraph">
<p><code>SearchSort.byField</code> tells the server to sort the rows using the value of a document field.</p>
</div>
<div class="paragraph">
<p>Required parameter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>field: String</code></strong>&#8201;&#8212;&#8201;Name of the field to use.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Optional parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>direction: Direction</code></strong>&#8201;&#8212;&#8201;Can be <code>ASCENDING</code> (A to Z) or <code>DESCENDING</code> (Z to A).
The default direction is <code>ASCENDING</code>.</p>
</li>
<li>
<p><strong><code>missing: Missing</code></strong>&#8201;&#8212;&#8201;Tells the server where to put rows that don&#8217;t have a value for the field.
Can be <code>FIRST</code> or <code>LAST</code>.
The default is <code>LAST</code>.</p>
</li>
<li>
<p><strong><code>type: FieldType</code></strong>&#8201;&#8212;&#8201;The type of the field.
Can be <code>STRING</code>, <code>NUMBER</code>, <code>DATE</code>, or <code>AUTO</code>.
The default type is <code>AUTO</code>, which tells the server to infer the type.</p>
</li>
<li>
<p><strong><code>mode: Mode</code></strong>&#8201;&#8212;&#8201;A field can have more than one value.
This happens if the value is an array, or if the value is a string that is analyzed as more than one token.
The <code>mode</code> parameter tells the server which value to use for sorting.
If a field does not have more than one value, this parameter does nothing.
Possible values:</p>
<div class="ulist">
<ul>
<li>
<p><strong><code>MIN</code></strong>&#8201;&#8212;&#8201;Use the minimum value.</p>
</li>
<li>
<p><strong><code>MAX</code></strong>&#8201;&#8212;&#8201;Use the maximum value.</p>
</li>
<li>
<p><strong><code>DEFAULT</code></strong>&#8201;&#8212;&#8201;The server sorts the rows the same way every time, but the order is unspecified.</p>
<div class="paragraph">
<p>The default mode is <code>DEFAULT</code>.</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sorting-by-score"><a class="anchor" href="#sorting-by-score"></a>Sorting by score</h3>
<div class="paragraph">
<p><code>SearchSort.byScore</code> tells the server to sort the rows using each row&#8217;s score.</p>
</div>
<div class="paragraph">
<p>Optional parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>direction: Direction</code></strong>&#8201;&#8212;&#8201;<code>ASCENDING</code> (low to high) or <code>DESCENDING</code> (high to low).
The default direction is <code>DESCENDING</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sorting-by-id"><a class="anchor" href="#sorting-by-id"></a>Sorting by document ID</h3>
<div class="paragraph">
<p><code>SearchSort.byId</code> tells the server to sort the rows using each row&#8217;s document ID.</p>
</div>
<div class="paragraph">
<p>Optional parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>direction: Direction</code></strong>&#8201;&#8212;&#8201;<code>ASCENDING</code> (A to Z) or <code>DESCENDING</code> (Z to A).
The default direction is <code>ASCENDING</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sorting-by-geo-distance"><a class="anchor" href="#sorting-by-geo-distance"></a>Sorting by geographic distance</h3>
<div class="paragraph">
<p><code>SearchSort.byGeoDistance</code> tells the server to look at a field that has a geographic location, and sort the rows based on how far the field value is from some other location.</p>
</div>
<div class="paragraph">
<p>Required parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>field: String</code></strong>&#8201;&#8212;&#8201;Name of the field to use.
The field must be indexed as a geographic point.</p>
</li>
<li>
<p><strong><code>location: GeoPoint</code></strong>&#8201;&#8212;&#8201;The starting point for measuring distance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Optional parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>direction: Direction</code></strong>&#8201;&#8212;&#8201;<code>ASCENDING</code> (near to far) or <code>DESCENDING</code> (far to near).
The default direction is <code>ASCENDING</code>.</p>
</li>
<li>
<p><strong><code>unit: GeoDistanceUnit</code></strong>&#8201;&#8212;&#8201;The unit of measurement to use for reporting the distance.
The default unit is <code>GeoDistanceUnit.METERS</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sorting-by-string-syntax"><a class="anchor" href="#sorting-by-string-syntax"></a>Sorting with string syntax</h3>
<div class="paragraph">
<p><code>SearchSort.by</code> lets you specify the sort using the syntax described in <a href="../../../server/7.1/fts/fts-search-response.html#sorting-with-strings" class="xref page">Sorting with Strings</a>.
For example:</p>
</div>
<div class="listingblock">
<div class="title">Sorting with strings</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" data-source-url="file:///Users/mariashodunke/Couchbase/docs/docs-sdk-kotlin//modules/howtos/examples/FullTextSearch.kt#L191-L193">val sort: SearchSort = SearchSort.by(
    "country", "state", "city", "-_score"
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="multi-level-sorting"><a class="anchor" href="#multi-level-sorting"></a>More than one sort</h3>
<div class="paragraph">
<p>You can join <code>SearchSort</code> objects to create a sort with more than one level.
Here are two examples that do the same thing in different ways:</p>
</div>
<div class="listingblock">
<div class="title">Multi-level sort using the <code>then</code> infix method</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" data-source-url="file:///Users/mariashodunke/Couchbase/docs/docs-sdk-kotlin//modules/howtos/examples/FullTextSearch.kt#L199-L200">val multiLevelSort: SearchSort =
    SearchSort.byField("country") then SearchSort.byId()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Multi-level sort using the <code>SearchSort.of</code> companion factory method</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" data-source-url="file:///Users/mariashodunke/Couchbase/docs/docs-sdk-kotlin//modules/howtos/examples/FullTextSearch.kt#L206-L209">val multiLevelSort: SearchSort = SearchSort.of(listOf(
    SearchSort.byField("country"),
    SearchSort.byId(),
))</code></pre>
</div>
</div>
<div class="paragraph">
<p>First, the rows are sorted by the value of the "country" field.
Then, rows with the same country are sorted by document ID.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The example for <a href="#sorting-by-string-syntax">Sorting with string syntax</a> also creates a multi-level sort.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pagination"><a class="anchor" href="#pagination"></a>Pagination</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you don&#8217;t need all the result rows at once, you can ask the server to return one page at a time.</p>
</div>
<div class="paragraph">
<p>The <code>searchQuery</code> method has a <code>limit</code> parameter that tells the server how many rows to return.
This is the page size.</p>
</div>
<div class="paragraph">
<p>There is also a <code>page</code> parameter that tells the server which rows to include in the results.
There are two ways to ask for a page.</p>
</div>
<div class="sect2">
<h3 id="offset-pagination"><a class="anchor" href="#offset-pagination"></a>Offset pagination</h3>
<div class="paragraph">
<p>With offset pagination, you tell the server how many result rows to skip before it should start including rows in the result.</p>
</div>
<div class="paragraph">
<p>For example, this code skips the first 10 rows:</p>
</div>
<div class="listingblock">
<div class="title">Offset-based pagination</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" data-source-url="file:///Users/mariashodunke/Couchbase/docs/docs-sdk-kotlin//modules/howtos/examples/FullTextSearch.kt#L216-L223">val searchResult: SearchResult = cluster
    .searchQuery(
        indexName = "travel-sample-index",
        query = SearchQuery.queryString("pool"),
        page = SearchPage.startAt(offset = 10), <i class="conum" data-value="1"></i><b>(1)</b>
        limit = 10,
    )
    .execute()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Offsets are zero-based, so this skips the first 10 rows.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This kind of pagination is unstable, because a row&#8217;s offset can change if a different document is changed, added, or removed.
Imagine this happens:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You ask for the first page, using offset 0 and limit 10.</p>
</li>
<li>
<p>Someone removes from Couchbase the document at offset 3.</p>
</li>
<li>
<p>You ask for the second page, using offset 10 and limit 10.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After step 2, the row that would have been the first row of the second page is now the last row of the first page.
Now in step 3, you don&#8217;t see the row that "moved" to the first page.</p>
</div>
<div class="paragraph">
<p>Offset pagination can be expensive if the offset is very large.</p>
</div>
</div>
<div class="sect2">
<h3 id="keyset-pagination"><a class="anchor" href="#keyset-pagination"></a>Keyset pagination</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Keyset pagination requires Couchbase Server 6.6.1 or later.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the server sorts the search results, it assigns a "sort key" to each row.
The sort key is also called the "keyset".</p>
</div>
<div class="paragraph">
<p>With keyset pagination, you tell the server to return the page after (or before) a row whose keyset you remember from a previous search.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example that uses offset pagination to get the first page.
Then it uses keyset pagination to get the next page.</p>
</div>
<div class="listingblock">
<div class="title">Keyset-based pagination</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" data-source-url="file:///Users/mariashodunke/Couchbase/docs/docs-sdk-kotlin//modules/howtos/examples/FullTextSearch.kt#L229-L258">val indexName = "travel-sample-index"
val query = SearchQuery.queryString("pool")
val sort = SearchSort.byId()
val pageSize = 10

val firstPage: SearchResult = cluster
    .searchQuery(
        indexName = indexName,
        query = query,
        sort = sort,
        limit = pageSize,
        page = SearchPage.startAt(offset = 0), <i class="conum" data-value="1"></i><b>(1)</b>
    )
    .execute()

check(firstPage.rows.isNotEmpty()) { "Oops, no results!" }
val lastRowOfFirstPage: SearchRow = firstPage.rows.last()

val nextPage: SearchResult = cluster
    .searchQuery(
        indexName = indexName,
        query = query,
        sort = sort,
        limit = pageSize,
        page = SearchPage.searchAfter( <i class="conum" data-value="2"></i><b>(2)</b>
            lastRowOfFirstPage.keyset
        ),
    )
    .execute()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Starting at offset 0 is the default.
You can remove this line.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>There is also a <code>searchBefore</code> method.
You can pass <code>SearchKeyset</code> or <code>SearchRow</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Keyset pagination is less expensive than offset pagination when the offset is large.
Keyset pagination is stable if you are careful about sorting.
See the cautions below.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
For stable keyset pagination, the <code>sort</code> argument must not let any two rows be equal.
It&#8217;s good to always use a <a href="#multi-level-sorting">multi-level sort</a> that ends with <code><a href="#sorting-by-id">SearchSort.byId()</a></code>, so no two rows are equal.
Be careful when searching a multi-collection index, since document IDs are only guaranteed to be unique within a single collection.
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Changing the sort invalidates a keyset (unless the new sort is the total opposite of the old sort).
If you use a keyset to search with a different sort, you get bad results.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>keyset.serialize()</code> converts a <code>SearchKeyset</code> to a string, so you can send it to a client.
When you receive the string back from the client, pass it to the <code>SearchKeyset.deserialize</code> companion factory method to turn it back into a <code>SearchKeyset</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="total-rows"><a class="anchor" href="#total-rows"></a>Total number of rows</h3>
<div class="paragraph">
<p>The search result metadata has a <code>totalRows</code> property that tells you how many rows matched the query, even if you limit the results to fewer rows.</p>
</div>
<div class="listingblock">
<div class="title">Getting the total number of rows</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" data-source-url="file:///Users/mariashodunke/Couchbase/docs/docs-sdk-kotlin//modules/howtos/examples/FullTextSearch.kt#L66-L75">val searchResult: SearchResult = cluster
    .searchQuery(
        indexName = "travel-sample-index",
        query = SearchQuery.queryString("pool"),
        limit = 10,
    )
    .execute()

val total = searchResult.metadata.metrics.totalRows <i class="conum" data-value="1"></i><b>(1)</b>
println("Total matching rows: $total")</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This can be greater than the <code>limit</code> argument.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="compound-queries"><a class="anchor" href="#compound-queries"></a>Compound Queries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use boolean logic to combine queries into a "compound query."</p>
</div>
<div class="paragraph">
<p>Imagine Alice is searching for a hotel.
She would prefer a hotel with a sauna, but she would settle for a swimming pool.</p>
</div>
<div class="paragraph">
<p>Alice can use a <code>disjunction</code> query to search for "sauna" <em>or</em> "pool".
She can <em>boost</em> the "sauna" query, so hotels with a sauna get higher scores relative to other hotels.</p>
</div>
<div class="listingblock">
<div class="title">"OR" query with boost</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" data-source-url="file:///Users/mariashodunke/Couchbase/docs/docs-sdk-kotlin//modules/howtos/examples/FullTextSearch.kt#L50-L59">val saunaOrPool: SearchQuery = SearchQuery.disjunction(
    SearchQuery.match("sauna") boost 1.5, <i class="conum" data-value="1"></i><b>(1)</b>
    SearchQuery.match("pool"),
)
val searchResult: SearchResult = cluster
    .searchQuery(
        indexName = "travel-sample-index",
        query = saunaOrPool,
    )
    .execute()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Alice thinks saunas are better than swimming pools, so she boosts this part of the query.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Boosting a query has no effect unless the query is part of a compound query.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are other kinds of compound queries.
Use <code>conjunction</code> for "and".
Use <code>negation</code> for "not".
Use <code>boolean</code> for a complex query with "must", "should", and "mustNot" sub-queries.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="facets"><a class="anchor" href="#facets"></a>Facets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A facet is like a histogram.
For each document matching the search query, the server inspects a field of the document to see which bin (or "category") the field value belongs to.</p>
</div>
<div class="paragraph">
<p>The FTS service supports three kinds of facets: <code>numeric</code>, <code>date</code>, and <code>term</code>.</p>
</div>
<div class="paragraph">
<p>For <code>numeric</code> and <code>date</code> facets, you specify the categories up front as value ranges.
Common use cases include counting the number of documents in certain price ranges, like: $1 to $5, $5 to $20, $20+, or time ranges like: "today", "yesterday", or "more than a week ago".</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Unlike a histogram, it&#8217;s okay if the ranges overlap.
If a field value matches more than one range, each matching range has its count incremented.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For <code>term</code> facets, the server creates one category for each distinct value it sees in the field.</p>
</div>
<div class="paragraph">
<p>For example, let&#8217;s say your documents have a "color" field where the value is one of "red", "green", or "blue".
The result of a <code>term</code> facet on the "color" field tells you the number of times each color appears as the field value.</p>
</div>
<div class="paragraph">
<p>Facets have a <code>size</code> parameter, which is an upper bound on the number of categories reported in the facet result.
For example, if you request a <code>size</code> of 3, the server does its best to return the 3 largest categories.
To be more precise, it selects the top 3 categories from each partition executing the query, and then merge each partition&#8217;s result into the final result.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are using multiple partitions and require an exact result, the size must be &gt;= the number of categories; otherwise the result should be considered an estimate.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Facet results are not affected by query pagination.</p>
</div>
<div class="paragraph">
<p>To create a facet, use one of the <code>SearchFacet</code> companion factory methods.
To retrieve the result in a type-safe way, pass the facet to <code>SearchResult.get</code> (or <code>SearchMetadata.get</code>).
Alternatively, iterate over <code>SearchResult.facets</code> (or <code>SearchMetadata.facets</code>) and cast each <code>FacetResult</code> to the appropriate type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Facets and/or ranges with no matching documents are omitted from the results.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This example uses the <code>beer-sample</code> bucket.
It requires an index called <code>beer-sample-index</code>, with fields "abv" and "category" indexed as stored fields.</p>
</div>
<div class="listingblock">
<div class="title">Searching with facets</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" data-source-url="file:///Users/mariashodunke/Couchbase/docs/docs-sdk-kotlin//modules/howtos/examples/FullTextSearch.kt#L264-L301">// Count results that fall into these "alcohol by volume" ranges.
// Optionally assign names to the ranges.
val low = NumericRange.bounds(min = 0, max = 3.5, name = "low")
val high = NumericRange.lowerBound(3.5, name = "high")
val abv = SearchFacet.numeric(
    field = "abv",
    ranges = listOf(low, high),
    name = "Alcohol by volume",
)

// Find the 5 most frequent values in the "category" field.
val beerType = SearchFacet.term("category", size = 5)

val result = cluster.searchQuery(
    indexName = "beer-sample-index",
    query = SearchQuery.matchAll(),
    facets = listOf(abv, beerType),
).execute()

// Print all facet results. Results do not include empty facets
// or ranges. Categories are ordered by size, descending.
result.facets.forEach { facet -&gt;
    println(facet.name)
    facet.categories.forEach { println("  $it") }
    facet.other.let { if (it &gt; 0) println("  &lt;other&gt; ($it)") }
    println()
}

// Alternatively, print results for a specific facet:
val abvResult = result[abv]
if (abvResult == null) {
    println("No search results matched any of the 'abv' facet ranges.")
} else {
    println("Alcohol by volume (again)")
    println(" low (${abvResult[low]?.count ?: 0})")
    println(" high (${abvResult[high]?.count ?: 0})")
    println()
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="scan-consistency"><a class="anchor" href="#scan-consistency"></a>Scan Consistency</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you change a document in Couchbase, it takes time for the FTS service to index the document.
An FTS index "runs behind" the KV service.
When you execute an FTS search, you get to choose if you want to wait for the index to "catch up" to the latest KV changes.</p>
</div>
<div class="sect2">
<h3 id="scan-consistency-unbounded"><a class="anchor" href="#scan-consistency-unbounded"></a>Unbounded</h3>
<div class="paragraph">
<p>By default, the FTS service does not wait.
It only searches documents that were already indexed when the search started.
This is called "unbounded" scan consistency.</p>
</div>
<div class="paragraph">
<p>This is the default value for the <code>searchQuery</code> method&#8217;s <code>consistency</code> parameter.</p>
</div>
</div>
<div class="sect2">
<h3 id="scan-consistency-consistent-with"><a class="anchor" href="#scan-consistency-consistent-with"></a>Consistent With</h3>
<div class="paragraph">
<p>If you made some changes, you can tell the server to wait for the changes to be indexed.
In other words, the search results are "consistent with" the changes you made.
To use this kind of scan consistency, you must keep track of the mutation tokens from the changes you want to wait for.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" data-source-url="file:///Users/mariashodunke/Couchbase/docs/docs-sdk-kotlin//modules/howtos/examples/FullTextSearch.kt#L307-L327">val collection = cluster
    .bucket("travel-sample")
    .defaultCollection()

val mutationResult: MutationResult =
    collection.upsert(
        id = "my-fake-hotel",
        content = mapOf("description" to "This hotel is imaginary.")
    )

val mutationState = MutationState()
mutationState.add(mutationResult)

val queryResult: SearchResult = cluster
    .searchQuery(
        indexName = "travel-sample-index",
        query = SearchQuery.match("imaginary"),
        consistency = SearchScanConsistency
            .consistentWith(mutationState),
    )
    .execute()</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="partial-failures"><a class="anchor" href="#partial-failures"></a>Partial Failures</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An FTS index can have multiple partitions that live on different Couchbase Server nodes.
If there is a problem with a partition, the FTS service gives you the results from only the healthy partitions.
Documents indexed by an unhealthy partition are not included in the results.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If no partitions are healthy, the <code>searchQuery</code> method throws an exception.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to know if the FTS service was able to search all partitions, check the <code>SearchMetadata.errors</code> property.
This property is a map where the key is the name of an index partition, and the value is an error reported by that partition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" data-source-url="file:///Users/mariashodunke/Couchbase/docs/docs-sdk-kotlin//modules/howtos/examples/FullTextSearch.kt#L333-L346">val searchResult: SearchResult = cluster
    .searchQuery(
        indexName = "travel-sample-index",
        query = SearchQuery.queryString("pool")
    )
    .execute()

if (searchResult.metadata.errors.isNotEmpty()) {
    println("Partial failure!")
}

searchResult.metadata.errors.forEach { (indexPartition, errorMessage) -&gt;
    println("Partition $indexPartition reported error: $errorMessage")
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="streaming"><a class="anchor" href="#streaming"></a>Streaming</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The previous examples store all result rows in memory.
If there are many rows, this can use a lot of memory.</p>
</div>
<div class="paragraph">
<p>To use less memory, pass a lambda to <code>execute</code> and work on each row one at a time, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin" data-source-url="file:///Users/mariashodunke/Couchbase/docs/docs-sdk-kotlin//modules/howtos/examples/FullTextSearch.kt#L82-L89">val searchMetadata: SearchMetadata = cluster
    .searchQuery(
        indexName = "travel-sample-index",
        query = SearchQuery.queryString("pool"),
    )
    .execute { row -&gt;
        println("Found row: $row")
    }</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The streaming version of <code>execute</code> returns <code>SearchMetadata</code> instead of <code>SearchResult</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2022 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"SDKs","components":["java-sdk","kotlin-sdk","nodejs-sdk","ruby-sdk"],"url":"/home/sdk.html","latestVersions":{"java-sdk":"3.4","kotlin-sdk":"1.0","nodejs-sdk":"4.1","ruby-sdk":"3.3"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
