<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Quick Start with Prometheus Monitoring | Couchbase Docs (Local)</title>
<link rel="canonical" href="https://maria-robobug.github.io/operator/2.3/tutorial-prometheus.html">
<link rel="stylesheet" href="../../_/css/site.css">
<script src="../../_/js/vendor/jquery.js"></script>
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="operator">
<meta name="dcterms.identifier" content="2.3">
<meta name="page-url" content="/operator/2.3/tutorial-prometheus.html">
<meta name="generator" content="Antora 3.0.1">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://maria-robobug.github.io/home/index.html">
                    <img src="../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://maria-robobug.github.io/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../cloud-native-database/index.html">
                      Cloud-Native
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/mariashodunke/Couchbase/docs/couchbase-operator//docs/user/modules/ROOT/pages/tutorial-prometheus.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="overview.html">Autonomous Operator</a></li>
<li class="crumb">Tutorials</li>
<li class="crumb">Monitoring</li>
<li class="crumb"><a href="tutorial-prometheus.html">Quick Start with Prometheus Monitoring</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Quick Start with Prometheus Monitoring</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
Enable and setup Prometheus Monitoring for the Couchbase Autonomous Operator.
</blockquote>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Tutorials are accurate at the time of writing but rely heavily on third party software.
Tutorials are provided to demonstrate how a particular problem may be solved.
Use of third party software is not supported by Couchbase.
For further help in the event of a problem, contact the relevant software maintainer.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This guide walks through recommended procedures for enabling and configuring Prometheus monitoring of the Couchbase Autonomous Operator.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Clone the <a href="https://github.com/coreos/kube-prometheus" target="_blank" rel="noopener"><code>kube-prometheus</code></a> repository from GitHub, but do not create any manifests just yet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ git clone https://github.com/coreos/kube-prometheus</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure you have a Kubernetes cluster running the Autonomous Operator with <a href="howto-prometheus.html" class="xref page">monitoring enabled</a> and follow the Prerequisites section in the <code>kube-prometheus</code> documentation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="manifests-setup"><a class="anchor" href="#manifests-setup"></a>Manifests Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Currently, the <code>kube-prometheus</code> project includes a folder called <code>manifests</code> that includes all the resources necessary to
run the Prometheus Operator. The Prometheus Operator creates our Prometheus deployment which scrapes endpoints continuously for Prometheus metrics.
We will be creating these manifests in a <a href="#Create-the-manifests">later step</a>.</p>
</div>
<div class="paragraph">
<p>The Autonomous Operator, with monitoring enabled, exposes the Couchbase Prometheus metrics on the sidecar containers running in each Couchbase Server pod.
Our task is then to get Prometheus to discover and scrape these endpoints in order to monitor the overall cluster through the Prometheus UI and with custom Grafana dashboards.</p>
</div>
<div class="paragraph">
<p>In order for our Prometheus deployment to recognize and scrape Couchbase endpoints, we need to create a Couchbase specific service monitor, and a Couchbase metrics specific service.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This tutorial works on the basis that the manifests which bring up the relevant resources for Prometheus Operator are still located in the folder <code>manifests</code>.
Please adjust accordingly if changes have been made since as the repository is experimental and subject to change.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="create-the-couchbase-metrics-service"><a class="anchor" href="#create-the-couchbase-metrics-service"></a>Create the Couchbase Metrics <code>Service</code></h3>
<div class="paragraph">
<p>The Couchbase Metrics <code>Service</code> will define the set of pods we want to monitor and the port to scrape on each.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Service
metadata:
  name: couchbase-metrics
  namespace: default <i class="conum" data-value="1"></i><b>(1)</b>
  labels:
    app: couchbase
spec:
  ports:
  - name: metrics
    port: 9091 <i class="conum" data-value="2"></i><b>(2)</b>
    protocol: TCP
  selector:
    app: couchbase
    couchbase_cluster: cb-example <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Make sure that the <code>Service</code> is in the same namespace as the Couchbase Cluster that you wish to scrape metrics from, otherwise no pods will be selected and no endpoints will be displayed on the Prometheus targets page (at <code>http://localhost:9090/targets</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Keep this port as its default value of 9091 as this is the default port the Couchbase Exporter will be writing to.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>app:couchbase</code> will select all Couchbase server pods in the specified namespace regardless of which cluster they belong to.
Adding the <code>couchbase_cluster: cb-example</code> selector will constrain the label selector to a specific cluster.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Copy this YAML into a file named, for example, <code>couchbase-service.yaml</code> and make sure it is placed in the <code>manifests</code> directory.</p>
</div>
</div>
<div class="sect2">
<h3 id="create-the-couchbase-servicemonitor"><a class="anchor" href="#create-the-couchbase-servicemonitor"></a>Create the Couchbase <code>ServiceMonitor</code></h3>
<div class="paragraph">
<p>The <code>ServiceMonitor</code> tells Prometheus to monitor the <code>Service</code> resource we just defined which then enables Prometheus to scrape for metrics provided by the Couchbase exporter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: couchbase
  namespace: default <i class="conum" data-value="1"></i><b>(1)</b>
  labels:
    app: couchbase
spec:
  endpoints:
  - port: metrics       <i class="conum" data-value="2"></i><b>(2)</b>
    interval: 5s        <i class="conum" data-value="3"></i><b>(3)</b>
    bearerTokenSecret:  <i class="conum" data-value="4"></i><b>(4)</b>
      key: token <i class="conum" data-value="5"></i><b>(5)</b>
      name: cb-metrics-token <i class="conum" data-value="6"></i><b>(6)</b>
  namespaceSelector:
    matchNames:
    - default <i class="conum" data-value="7"></i><b>(7)</b>
  selector:
    matchLabels:
      app: couchbase <i class="conum" data-value="8"></i><b>(8)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You may wish to include our Couchbase <code>ServiceMonitor</code> in the <code>monitoring</code> namespace along with the other <code>ServiceMonitors</code> included in the provided <code>kube-prometheus</code> manifests.
For examples of this tutorial we have just left it in the <code>default</code> namespace for ease of use.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>port</code> may be a literal port number as defined in the <code>couchbase-metrics</code> service, or may reference the port in the same service by name.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>interval</code> tells Prometheus how often to scrape the endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If it is specified in the <code>CouchbaseCluster</code> spec, by <a href="howto-prometheus.html#Configuration" class="xref page"><code>spec.monitoring.prometheus.authorizationSecret</code></a>, we then need to provide the correct <code>Secret</code> details in order for Prometheus to be able to gain access to the scrape endpoints.
Please see <a href="howto-prometheus.html#Configuration" class="xref page">Configure Prometheus Metrics Collection</a> on how to create said <code>Secret</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Pass in the value of the <code>key</code> field in the secret data.
In this example the <code>key</code> value is <code>token</code> if we have the corresponding <code>Secret</code> with value <code>{data: {token: base64encodedTokenHere}}</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>name</code> is simply the name of your <code>Secret</code> containing the bearer token.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Here we want to match the namespace of the Couchbase Metrics <code>Service</code> we have just created.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Similar to the <code>namespaceSelector</code>, this is a simple <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/"><code>labelSelector</code></a> that will look for our <code>Service</code> through label discovery.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Copy this YAML into a file named <code>couchbase-serviceMonitor.yaml</code> for example, and save it in the <code>manifests</code> directory.
If we were to just run with this <code>ServiceMonitor</code> and without any defined <code>Service</code> we would see on our Prometheus targets page a section for Couchbase endpoints but none showing.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-the-manifests"><a class="anchor" href="#create-the-manifests"></a>Create the Manifests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Follow the specific commands given in the <code>kube-prometheus</code> documentation to bring up our created resources along with the other provided default manifests.</p>
</div>
<div class="paragraph">
<p>Components such as Prometheus, Alertmanager, Node Exporter and Grafana should then startup and we can confirm this by inspecting the pods in the namespace <code>monitoring</code>.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_kubernetes"></a>Kubernetes</p>
</li>
<li>
<p><a id="tabset1_openshift"></a>OpenShift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_kubernetes">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kubectl get pods -n monitoring</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_openshift">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ oc get pods -n monitoring</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Check that our <code>ServiceMonitor</code> and <code>Service</code> have been created.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_kubernetes"></a>Kubernetes</p>
</li>
<li>
<p><a id="tabset2_openshift"></a>OpenShift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_kubernetes">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kubectl get servicemonitor couchbase
$ kubectl get service couchbase-metrics</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_openshift">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ oc get servicemonitor couchbase
$ oc get service couchbase-metrics</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To check that all is working correctly with the Prometheus Operator deployment, run the following command to view the logs:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset3_kubernetes"></a>Kubernetes</p>
</li>
<li>
<p><a id="tabset3_openshift"></a>OpenShift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset3_kubernetes">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kubectl logs -f deployments/prometheus-operator -n monitoring prometheus-operator</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset3_openshift">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ oc logs -f deployments/prometheus-operator -n monitoring prometheus-operator</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Any potential issues that may arise should be fairly straight forward to debug and understand.
One you may run into is the <code>ServiceMonitor</code> reporting problems due to your bearer token Secret not being created.</p>
</div>
<div class="paragraph">
<p>Once all pods are ready and running, in order to access Prometheus and Grafana, follow the relevant steps in the <code>kube-prometheus</code> documentation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="working-with-the-prometheus-operator-helm-chart"><a class="anchor" href="#working-with-the-prometheus-operator-helm-chart"></a>Working with the Prometheus Operator Helm Chart</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is also possible to instead use the <a href="https://github.com/helm/charts/tree/master/stable/prometheus-operator" target="_blank" rel="noopener">Prometheus Operator Helm chart</a> which closely matches the <code>kube-prometheus</code> project.
To do so we must make Prometheus aware of the additional Service Monitor to monitor our Couchbase metrics service.</p>
</div>
<div class="paragraph">
<p>We use a YAML file to include in the <code>values</code> argument in <code>helm install</code> which will introduce additional configuration into the Helm Chart.
The following example YAML is almost an exact replica of the Service Monitor YAML example in the <a href="#create-the-couchbase-servicemonitor">earlier section</a>, but with a few important differences.
These differences exist due to the way that the Helm Chart structure has been defined.
For further information see the defined <a href="https://github.com/helm/charts/tree/master/stable/prometheus-operator/values.yaml" target="_blank" rel="noopener"><code>values.yaml</code></a> in the Helm chart GitHub repository.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">prometheus:
  prometheusSpec:
    additionalServiceMonitors:
      - name: couchbase
        additionalLabels:
          - app: couchbase
        endpoints:
          - port: metrics
            interval: 5s
             bearerTokenFile:
               key: token
               name: cb-metrics-token
        namespaceSelector:
          matchNames:
            - default
        selector:
          matchLabels:
            app: couchbase</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once this YAML file is created and saved, we can then deploy the Prometheus Operator with Helm using the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">helm install prometheus-operator stable/prometheus-operator --values your-helm-config.yaml -n your-namespace</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make sure the Helm chart will be deployed with the additional configuration, you can add the argument <code>--dry-run</code> to the command to view the intended configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-bash hljs" data-lang="bash">helm install prometheus-operator stable/prometheus-operator --values your-helm-config.yaml -n your-namespace --dry-run</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you wish to deploy the Prometheus Operator in a separate namespace, make sure to create that namespace if it does not already exist.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset4_kubernetes"></a>Kubernetes</p>
</li>
<li>
<p><a id="tabset4_openshift"></a>OpenShift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset4_kubernetes">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ kubectl create namespace your-namespace</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset4_openshift">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ oc create namespace your-namespace</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Now all we need to do is make sure our Couchbase service and Service Monitor are deployed for the Prometheus Operator to recognize.
However the Prometheus Operator Helm chart deployment requires an extra bit of configuration to the Service Monitor for the Service Monitor to show up in Prometheus.
The Prometheus Operator has a <code>labelSelector</code> defined looking for the label <code>release: prometheus-operator</code> so we need to add this to our Couchbase Service Monitor.
With this label added the Service Monitor will look something like the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: couchbase
  namespace: default
  labels:
    app: couchbase
    release: prometheus-operator
spec:
  endpoints:
  - port: metrics
    interval: 5s
    bearerTokenSecret:
      key: token
      name: cb-metrics-token
  namespaceSelector:
    matchNames:
    - default
  selector:
    matchLabels:
      app: couchbase</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deploy this slightly modified <code>ServiceMonitor</code> and the Couchbase metrics service.</p>
</div>
<div class="paragraph">
<p>We can now use commands similar to the ones found in the <a href="https://github.com/coreos/kube-prometheus" target="_blank" rel="noopener"><code>kube-prometheus</code></a> documentation, to access Prometheus Server and Grafana.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset5_kubernetes"></a>Kubernetes</p>
</li>
<li>
<p><a id="tabset5_openshift"></a>OpenShift</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset5_kubernetes">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-console hljs" data-lang="console">$ kubectl port-forward -n your-namespace pod/prometheus-prometheus-operator-prometheus-0 9090:9090
$ kubectl port-forward -n your-namespace deployment/prometheus-operator-grafana 3000:3000</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset5_openshift">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ oc port-forward -n your-namespace pod/prometheus-prometheus-operator-prometheus-0 9090:9090
$ oc port-forward -n your-namespace deployment/prometheus-operator-grafana 3000:3000</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>An important distinction however is that the Grafana default password will be different.
At time of writing the default password is <code>prom-operator</code> rather than <code>admin</code> as it is in <code>kube-prometheus</code>.
The default password can be discovered in the <code>prometheus-operator-grafana</code> secret through base64 decoding.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2022 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Autonomous Operator","components":["operator"],"latestVersions":{"operator":"2.3"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../_/js/site.js"></script>
<script defer src="../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
</body>
</html>
